<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>‚ö°Ô∏èGoGo Lite Premium</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEpi7FZL1FN9fZ7P1dTnKpJpN9K7R9j+8Rz5g==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
<style>
:root{
  --bg: linear-gradient(160deg,#ffecd2 0%,#fcb69f 42%,#fbc2eb 72%,#a6c1ee 100%);
  --glass: rgba(255,255,255,.28);
  --radius: 18px;
  --brand: #ffd43b;
  --accent: #ff6b6b;
  --success: #51cf66;
  --info: #4dabf7;
  --warning: #ffd93d;
  --text: #212529;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background: var(--bg);
  display:flex; align-items:center; justify-content:center;
}
#app{
  width: 380px; height: 720px; border-radius: 26px; overflow:hidden; position:relative;
  box-shadow:0 20px 45px rgba(0,0,0,.25);
  display:flex; flex-direction:column;
  background: linear-gradient(135deg,#ff9a9e,#fad0c4,#fbc2eb,#a18cd1);
}
/* ===== Top Nav (Main Menu) ===== */
.header{
  background: linear-gradient(180deg,rgba(255,255,255,.55),rgba(255,255,255,.32));
  backdrop-filter: blur(10px) saturate(140%);
  padding: 10px 10px 6px; position:relative; z-index:3;
  box-shadow: 0 6px 18px rgba(0,0,0,.12);
}
.brand{
  display:flex; align-items:center; justify-content:space-between; gap:8px;
}
.brand-title{
  font-weight:900; font-size:22px; letter-spacing:.2px;
  background:linear-gradient(270deg,#fff,#ffe66d,#ff6b6b,#fff);
  background-size:600% 600%;
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  animation: shift 7s ease infinite;
}
@keyframes shift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.balance-chip{
  background: rgba(255,255,255,.7); border:1px solid rgba(0,0,0,.06);
  padding:6px 10px; border-radius:999px; font-weight:800; display:flex; gap:8px; align-items:center;
}
.balance-chip i{color:#2b8a3e}

.main-menu{ display:flex; gap:6px; margin-top:8px }
.main-btn{
  flex:1; border:none; cursor:pointer; border-radius:14px; padding:10px 6px;
  background: rgba(255,255,255,.55);
  backdrop-filter: blur(8px) saturate(140%);
  font-weight:800; display:flex; align-items:center; justify-content:center; gap:8px;
  transition:.15s; color: var(--text);
}
.main-btn i{opacity:.9}
.main-btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.75) }
.main-btn.active{ background: var(--brand); box-shadow:0 8px 18px rgba(0,0,0,.15) }

/* ===== Sub Tabs ===== */
.subtabs{ display:flex; gap:8px; padding:8px; position:relative; z-index:2 }
.subtab{
  border:none; padding:8px 12px; border-radius:999px; cursor:pointer; font-weight:800;
  background: rgba(255,255,255,.6); backdrop-filter: blur(6px);
}
.subtab.active{ background:#ffe066 }

/* ===== Content ===== */
.content{ flex:1; overflow:auto; padding:10px; position:relative }
.section{
  background: var(--glass); backdrop-filter: blur(10px) saturate(130%);
  border-radius: var(--radius); padding:12px; box-shadow: 0 10px 26px rgba(0,0,0,.18);
  animation: fadeIn .2s ease;
}
@keyframes fadeIn{from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none}}
.section + .section{ margin-top:10px }
.card{ background: rgba(255,255,255,.8); border-radius:14px; padding:10px; box-shadow:0 6px 14px rgba(0,0,0,.12) }
.title{ font-weight:900; margin-bottom:8px; font-size:16px }

/* ===== Check-in ===== */
.week-grid{ display:grid; grid-template-columns: repeat(7,1fr); gap:8px }
.day{
  background:#ffe66d; border-radius:14px; height:56px; display:flex; flex-direction:column; align-items:center; justify-content:center;
  font-weight:900; cursor:pointer; transition:.12s; box-shadow:0 4px 10px rgba(0,0,0,.12);
}
.day small{font-weight:600}
.day:hover{ transform:translateY(-2px); background:#ffd93d }
.day.checked{ background:#6BCB77; color:#fff }
.bonus-box{ display:flex; align-items:center; justify-content:space-between; gap:10px }
.bonus-btn{ border:none; border-radius:12px; padding:10px 12px; background:#845ef7; color:#fff; font-weight:900; cursor:pointer }
.bonus-btn:disabled{ opacity:.6; cursor:not-allowed }

/* ===== Quests / Video ===== */
.progress{ width:100%; height:10px; border-radius:999px; overflow:hidden; background:rgba(0,0,0,.08) }
.progress > div{ height:100%; background:#4dabf7; width:0 }
.row{ display:flex; gap:8px; align-items:center; justify-content:space-between }
.badge{ padding:4px 8px; border-radius:999px; background:#e7f5ff; font-weight:800; font-size:12px }
.action{ border:none; border-radius:12px; padding:10px 12px; background:var(--accent); color:#fff; font-weight:900; cursor:pointer }
.action:hover{ filter:brightness(.98) }
.timer{ font-variant-numeric: tabular-nums; font-weight:900 }

/* ===== Shop & Inventory ===== */
.shop-grid{ display:grid; grid-template-columns:1fr 1fr; gap:8px }
.item{ background:#fff; border-radius:12px; padding:10px; box-shadow:0 6px 14px rgba(0,0,0,.12) }
.item h4{ margin:0 0 6px; font-size:14px }
.item .price{ font-weight:900 }
.inv-list{ display:flex; flex-wrap:wrap; gap:6px }
.inv-chip{ background:#fff; border-radius:999px; padding:6px 10px; box-shadow:0 3px 8px rgba(0,0,0,.12); font-weight:800 }

/* ===== Tables ===== */
.table{ width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:12px; box-shadow:0 6px 16px rgba(0,0,0,.12) }
.table thead th{ background:#ffd43b; padding:8px; text-align:left; font-size:13px }
.table tbody td{ background:rgba(255,255,255,.9); padding:8px; font-size:13px; border-top:1px solid rgba(0,0,0,.06) }

/* ===== Toast / Coins ===== */
.coin{ position:absolute; width:18px; height:18px; background:gold; border-radius:50%; top:-20px; animation:fall linear forwards }
@keyframes fall{ to{ transform:translateY(860px) rotate(360deg); opacity:0 } }
.overlay{ position:fixed; inset:0; background:rgba(0,0,0,.45); backdrop-filter:blur(5px); display:flex; align-items:center; justify-content:center; z-index:9 }
.toast{ width:86%; max-width:340px; background:linear-gradient(145deg,#ffffff,#f6f6f6); border-radius:18px; padding:16px; text-align:center; box-shadow:0 14px 40px rgba(0,0,0,.25) }
.toast h3{ margin:6px 0 4px; font-size:18px }
.toast p{ margin:0; opacity:.85; font-size:13px }
.toast .btns{ display:flex; gap:8px; justify-content:center; margin-top:12px }
.toast .btns button{ padding:8px 12px; border:none; border-radius:12px; font-weight:800; cursor:pointer }
.toast .btns .primary{ background:var(--brand) }

/* Small helpers */
.muted{ opacity:.75 }
.center{ text-align:center }
.mt8{ margin-top:8px }
.mt10{ margin-top:10px }
.mt12{ margin-top:12px }
.right{ text-align:right }
</style>
</head>
<body>
<div id="app">
  <div class="header">
    <div class="brand">
      <div class="brand-title">‚ö°Ô∏èGoGo Lite Premium</div>
      <div class="balance-chip" title="S·ªë d∆∞ hi·ªán t·∫°i">
        <i class="fa-solid fa-coins"></i>
        <span id="balanceText">‚Äî</span>
      </div>
    </div>
    <div class="main-menu" id="mainMenu"></div>
  </div>
  <div class="subtabs" id="subTabs"></div>
  <div class="content" id="content"></div>
</div>

<script>
/********************
 * State & Utilities *
 ********************/
const $ = s => document.querySelector(s);
const fmt = n => (n||0).toLocaleString('vi-VN');

const LS = {
  balance: 'gogo.balance',
  tx: 'gogo.transactions',
  withdraw: 'gogo.withdraws',
  user: 'gogo.user',
  inventory: 'gogo.inventory',
  codes: 'gogo.codes',
  checkin: 'gogo.checkin',
  quests: 'gogo.quests'
};

// init
let balance = parseInt(localStorage.getItem(LS.balance) || '10000000', 10);
let transactions = JSON.parse(localStorage.getItem(LS.tx) || '[]'); // {time, amount, reason}
let withdrawHistory = JSON.parse(localStorage.getItem(LS.withdraw) || '[]'); // {time, bank, amount}
let user = JSON.parse(localStorage.getItem(LS.user) || '{"name":"Kh√°ch","exp":0}');
let inventory = JSON.parse(localStorage.getItem(LS.inventory) || '[]');
let codes = JSON.parse(localStorage.getItem(LS.codes) || '{}');
let checkin = JSON.parse(localStorage.getItem(LS.checkin) || '{}'); // {weekKey, days:[1..7], bonusClaimedWeeks: []}
let quests = JSON.parse(localStorage.getItem(LS.quests) || '{}'); // {date:{video:0, code:false, checkin:false, claimed:false}}

function save(k,v){ localStorage.setItem(k, typeof v==='string'? v : JSON.stringify(v)); }
function saveAll(){ save(LS.balance, String(balance)); save(LS.tx, transactions); save(LS.withdraw, withdrawHistory); save(LS.user, user); save(LS.inventory, inventory); save(LS.codes, codes); save(LS.checkin, checkin); save(LS.quests, quests); }

function nowVN(){ return new Date().toLocaleString('vi-VN'); }
function todayKey(){ const d=new Date(); return d.toISOString().slice(0,10); }

// ISO-ish week key (year-week)
function weekKey(){
  const d = new Date();
  const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
  // Thursday in current week decides the year.
  date.setUTCDate(date.getUTCDate() + 4 - (date.getUTCDay()||7));
  const yearStart = new Date(Date.UTC(date.getUTCFullYear(),0,1));
  const weekNo = Math.ceil((((date - yearStart) / 86400000) + 1)/7);
  return `${date.getUTCFullYear()}-W${weekNo}`;
}

function ensureCheckinWeek(){
  const wk = weekKey();
  if(!checkin.weekKey || checkin.weekKey !== wk){
    checkin = { weekKey: wk, days: [], bonusClaimedWeeks: (checkin.bonusClaimedWeeks||[]) };
    save(LS.checkin, checkin);
  }
}

function level(){ return Math.floor((user.exp||0)/1000) + 1; }
function addExp(x){ user.exp = (user.exp||0) + x; save(LS.user, user); renderHeader(); }

// Unified balance updater
function updateBalance(amount, reason){
  const newBal = balance + amount;
  if(newBal < 0) return false; // block if insufficient
  balance = newBal;
  transactions.unshift({ time: nowVN(), amount, reason });
  if(transactions.length > 100) transactions.pop();
  saveAll();
  renderHeader();
  popMoney(`${amount>0?'+':''}${fmt(amount)} VNƒê\n${reason||''}`);
  return true;
}

/**************
 * UI helpers *
 **************/
function popMoney(message){
  for(let i=0;i<10;i++){
    const coin=document.createElement('div');
    coin.className='coin'; coin.style.left=(Math.random()*340+10)+'px';
    coin.style.animationDuration=(Math.random()*1.4+1.4)+'s';
    document.body.appendChild(coin); setTimeout(()=>coin.remove(), 2600);
  }
  showToast('Thao t√°c th√†nh c√¥ng', message, 'success');
  playTing();
}

function playTing(){
  try{
    const ctx = new (window.AudioContext||window.webkitAudioContext)();
    const o = ctx.createOscillator(); const g = ctx.createGain();
    o.type='triangle'; o.frequency.setValueAtTime(880, ctx.currentTime);
    o.frequency.exponentialRampToValueAtTime(1760, ctx.currentTime+0.12);
    g.gain.setValueAtTime(0.001, ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime+0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.25);
    o.connect(g); g.connect(ctx.destination); o.start(); o.stop(ctx.currentTime+0.26);
  }catch(e){}
}

function showToast(title, desc, type='info'){
  const overlay=document.createElement('div'); overlay.className='overlay';
  const box=document.createElement('div'); box.className='toast';
  const icon = type==='success'? 'üí∏' : type==='error'? '‚ùå' : '‚ÑπÔ∏è';
  box.innerHTML = `<div style="font-size:42px">${icon}</div><h3>${title}</h3><p>${desc||''}</p><div class="btns"><button onclick="this.closest('.overlay').remove()">ƒê√≥ng</button><button class="primary" onclick="this.closest('.overlay').remove()">OK</button></div>`;
  overlay.appendChild(box); document.body.appendChild(overlay);
  setTimeout(()=>{ if(document.body.contains(overlay)) overlay.remove(); }, 3000);
}

/****************
 * Menu / Tabs  *
 ****************/
const MAIN = {
  home:   { label:'Trang ch·ªß', icon:'fa-house', subtabs:['T·ªïng quan'] },
  checkin:{ label:'ƒêi·ªÉm danh', icon:'fa-calendar-check', subtabs:['ƒêi·ªÉm danh tu·∫ßn','Bonus tu·∫ßn'] },
  quests: { label:'Nhi·ªám v·ª•', icon:'fa-list-check', subtabs:['Daily','Weekly'] },
  shop:   { label:'Shop', icon:'fa-store', subtabs:['C·ª≠a h√†ng','Kho ƒë·ªì'] },
  wallet: { label:'V√≠ & L·ªãch s·ª≠', icon:'fa-wallet', subtabs:['S·ªë d∆∞','L·ªãch s·ª≠ giao d·ªãch','L·ªãch s·ª≠ r√∫t'] },
  profile:{ label:'C√° nh√¢n', icon:'fa-user', subtabs:['H·ªì s∆°','Nh·∫≠p m√£','BXH'] },
};
let currentMain = 'home';
let currentSubIndex = 0;

function renderHeader(){ $('#balanceText').textContent = fmt(balance) + ' VNƒê'; }

function renderMainMenu(){
  const mm = $('#mainMenu'); mm.innerHTML='';
  Object.entries(MAIN).forEach(([key, cfg])=>{
    const b=document.createElement('button'); b.className='main-btn'+(key===currentMain?' active':'');
    b.innerHTML = `<i class="fa-solid ${cfg.icon}"></i><span>${cfg.label}</span>`;
    b.onclick=()=>{ currentMain = key; currentSubIndex = 0; renderSubTabs(); renderContent(); };
    mm.appendChild(b);
  });
}

function renderSubTabs(){
  const st = $('#subTabs'); st.innerHTML='';
  MAIN[currentMain].subtabs.forEach((name, i)=>{
    const b=document.createElement('button'); b.className='subtab'+(i===currentSubIndex?' active':''); b.textContent=name;
    b.onclick=()=>{ currentSubIndex=i; renderContent(); };
    st.appendChild(b);
  });
}

function renderContent(){
  const c = $('#content'); c.innerHTML='';
  const sub = MAIN[currentMain].subtabs[currentSubIndex];
  if(currentMain==='home') return renderHome(c);
  if(currentMain==='checkin') return (sub==='ƒêi·ªÉm danh tu·∫ßn'? renderCheckinWeek(c) : renderCheckinBonus(c));
  if(currentMain==='quests') return (sub==='Daily'? renderQuestDaily(c) : renderQuestWeekly(c));
  if(currentMain==='shop') return (sub==='C·ª≠a h√†ng'? renderShop(c) : renderInventory(c));
  if(currentMain==='wallet'){
    if(sub==='S·ªë d∆∞') return renderWallet(c);
    if(sub==='L·ªãch s·ª≠ giao d·ªãch') return renderTx(c);
    if(sub==='L·ªãch s·ª≠ r√∫t') return renderWithdrawHistory(c);
  }
  if(currentMain==='profile'){
    if(sub==='H·ªì s∆°') return renderProfile(c);
    if(sub==='Nh·∫≠p m√£') return renderRedeem(c);
    if(sub==='BXH') return renderLeaderboard(c);
  }
}

/****************
 * Renderers     *
 ****************/
function renderHome(c){
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML = `
    <div class="title">‚ú® T·ªïng quan</div>
    <div class="card">
      <div><b>T√™n:</b> ${user.name||'Kh√°ch'} &nbsp; <span class="badge">Lvl ${level()}</span></div>
      <div class="mt8"><b>EXP:</b> ${fmt(user.exp||0)} / <span class="muted">m·ªói 1,000 EXP = +1 c·∫•p</span></div>
      <div class="mt8"><b>Tu·∫ßn hi·ªán t·∫°i:</b> ${weekKey()}</div>
      <div class="mt8"><b>H√¥m nay:</b> ${new Date().toLocaleDateString('vi-VN')}</div>
    </div>
    <div class="card mt10">
      <div class="row"><div><i class="fa-solid fa-right-to-bracket"></i> ƒêi·ªÉm danh tu·∫ßn</div><button class="action" onclick="currentMain='checkin'; currentSubIndex=0; renderSubTabs(); renderContent();">V√†o ngay</button></div>
    </div>
  `;
  c.appendChild(sec);
}

function renderCheckinWeek(c){
  ensureCheckinWeek();
  const weekDays=['T2','T3','T4','T5','T6','T7','CN'];
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML = `<div class="title">üìÖ ƒêi·ªÉm danh theo tu·∫ßn (7 ng√†y, m·ªói ng√†y +55,000 VNƒê)</div>`;
  const grid=document.createElement('div'); grid.className='week-grid';
  for(let i=1;i<=7;i++){
    const d=document.createElement('div'); d.className='day'+(checkin.days.includes(i)?' checked':'');
    d.innerHTML = `<div>${weekDays[(i-1)%7]}</div><small>${i}</small>`;
    d.onclick=()=>{
      if(checkin.days.includes(i)) return;
      checkin.days.push(i); save(LS.checkin, checkin);
      const ok = updateBalance(55000, 'ƒêi·ªÉm danh tu·∫ßn ‚Äì Ng√†y '+i);
      if(ok){ addExp(50); markQuestToday('checkin'); renderContent(); }
    };
    grid.appendChild(d);
  }
  sec.appendChild(grid);
  const hint=document.createElement('div'); hint.className='mt10 muted center';
  hint.textContent = `Tu·∫ßn: ${checkin.weekKey}. H√£y ƒëi·ªÉm danh ƒë·ªß 7 ng√†y ƒë·ªÉ nh·∫≠n Bonus tu·∫ßn!`;
  sec.appendChild(hint);
  c.appendChild(sec);
}

function renderCheckinBonus(c){
  ensureCheckinWeek();
  const sec=document.createElement('div'); sec.className='section';
  const done7 = checkin.days.length>=7;
  const already = (checkin.bonusClaimedWeeks||[]).includes(checkin.weekKey);
  const btn = document.createElement('button'); btn.className='bonus-btn'; btn.textContent='Nh·∫≠n Bonus +200,000 VNƒê';
  btn.disabled = !done7 || already;
  btn.onclick=()=>{
    if(already) return;
    if(!done7) return showToast('Ch∆∞a ƒë·ªß ƒëi·ªÅu ki·ªán', 'ƒêi·ªÉm danh ƒë·ªß 7 ng√†y ƒë·ªÉ nh·∫≠n th∆∞·ªüng', 'info');
    checkin.bonusClaimedWeeks = checkin.bonusClaimedWeeks || []; checkin.bonusClaimedWeeks.push(checkin.weekKey);
    save(LS.checkin, checkin);
    if(updateBalance(200000, 'Bonus tu·∫ßn ho√†n th√†nh')){ addExp(120); renderContent(); }
  };
  sec.innerHTML = `<div class="title">üéÅ Bonus tu·∫ßn</div>`;
  const box=document.createElement('div'); box.className='card bonus-box';
  box.innerHTML = `<div>
      <div><b>Tr·∫°ng th√°i:</b> ${done7? (already? 'ƒê√£ nh·∫≠n tu·∫ßn n√†y' : 'ƒê·ªß ƒëi·ªÅu ki·ªán') : 'Ch∆∞a ƒë·ªß 7 ng√†y'}</div>
      <div class="muted">Tu·∫ßn ${checkin.weekKey} ‚Ä¢ S·ªë ng√†y: ${checkin.days.length}/7</div>
    </div>`;
  box.appendChild(btn);
  sec.appendChild(box);
  c.appendChild(sec);
}

// Quests
function ensureQuestToday(){
  const key=todayKey();
  if(!quests[key]) quests[key] = { video:0, code:false, checkin:false, claimed:false };
  return quests[key];
}
function markQuestToday(type){
  const q=ensureQuestToday();
  if(type==='checkin') q.checkin=true;
  if(type==='code') q.code=true;
  if(type==='video') q.video = Math.min(3, (q.video||0)+1);
  save(LS.quests, quests);
}

function renderQuestDaily(c){
  const q=ensureQuestToday();
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML = `<div class="title">üìù Nhi·ªám v·ª• h√†ng ng√†y</div>`;

  // Watch video with timer (15s demo)
  const card1=document.createElement('div'); card1.className='card';
  const bar=document.createElement('div'); bar.className='progress mt8'; const fill=document.createElement('div'); fill.style.width=(q.video/3*100)+'%'; bar.appendChild(fill);
  const row1=document.createElement('div'); row1.className='row';
  const info1=document.createElement('div'); info1.innerHTML = `<b>Xem video</b> <span class="badge">${q.video}/3</span>`;
  const btn1=document.createElement('button'); btn1.className='action'; btn1.textContent='B·∫Øt ƒë·∫ßu 15s';
  let timer=null, t=15; const timerSpan=document.createElement('span'); timerSpan.className='timer muted'; timerSpan.textContent='';
  btn1.onclick=()=>{
    if(q.video>=3) return;
    btn1.disabled=true; t=15; timerSpan.textContent=' 15s';
    timer=setInterval(()=>{ t--; timerSpan.textContent=` ${t}s`; if(t<=0){ clearInterval(timer); btn1.disabled=false; q.video++; save(LS.quests, quests); updateBalance(50000,'Th∆∞·ªüng xem video'); addExp(40); renderContent(); } },1000);
  };
  const tools1=document.createElement('div'); tools1.appendChild(btn1); tools1.appendChild(timerSpan);
  row1.appendChild(info1); row1.appendChild(tools1);
  card1.appendChild(row1); card1.appendChild(bar);

  // Check-in task
  const card2=document.createElement('div'); card2.className='card mt10';
  card2.innerHTML = `<div class="row"><div><b>ƒêi·ªÉm danh h√¥m nay</b> ${q.checkin?'<span class="badge">ƒê√£ l√†m</span>':''}</div><button class="action" ${q.checkin? 'disabled':''} onclick="currentMain='checkin'; currentSubIndex=0; renderSubTabs(); renderContent();">Th·ª±c hi·ªán</button></div>`;

  // Redeem code task
  const card3=document.createElement('div'); card3.className='card mt10';
  card3.innerHTML = `<div class="row"><div><b>Nh·∫≠p m√£ th∆∞·ªüng</b> ${q.code?'<span class=\"badge\">ƒê√£ l√†m</span>':''}</div><button class="action" onclick="currentMain='profile'; currentSubIndex=1; renderSubTabs(); renderContent();">Nh·∫≠p m√£</button></div>`;

  // Daily claim once all done
  const canClaim = q.video>=3 && q.checkin && q.code && !q.claimed;
  const claim=document.createElement('button'); claim.className='action mt10'; claim.textContent='Nh·∫≠n th∆∞·ªüng Daily +80,000 VNƒê';
  claim.disabled = !canClaim;
  claim.onclick=()=>{ if(canClaim){ q.claimed=true; save(LS.quests, quests); updateBalance(80000,'Nhi·ªám v·ª• Daily ho√†n th√†nh'); addExp(100); renderContent(); } };

  sec.appendChild(card1); sec.appendChild(card2); sec.appendChild(card3); sec.appendChild(claim);
  c.appendChild(sec);
}

function renderQuestWeekly(c){
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML = `<div class="title">üì¶ Nhi·ªám v·ª• tu·∫ßn (demo)</div><div class="card">Ho√†n th√†nh 7 ng√†y ƒëi·ªÉm danh + xem 10 video trong tu·∫ßn ƒë·ªÉ nh·∫≠n th√™m <b>+300,000 VNƒê</b> (ƒëang ph√°t tri·ªÉn)</div>`;
  c.appendChild(sec);
}

function renderShop(c){
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML = `<div class="title">üõçÔ∏è C·ª≠a h√†ng</div>`;
  const grid=document.createElement('div'); grid.className='shop-grid';
  const items=[
    { id:'coupon10', name:'Coupon +10k', price:10000 },
    { id:'boost50', name:'EXP Boost +50', price:20000 },
    { id:'skin1', name:'Skin V√†ng', price:120000 },
    { id:'skin2', name:'Skin T√≠m', price:120000 },
  ];
  items.forEach(it=>{
    const el=document.createElement('div'); el.className='item';
    el.innerHTML = `<h4>${it.name}</h4><div class="row"><div class="price">${fmt(it.price)} VNƒê</div><button class="action">Mua</button></div>`;
    el.querySelector('button').onclick=()=>{
      const ok = updateBalance(-it.price, `Mua ${it.name}`);
      if(!ok) return showToast('Kh√¥ng ƒë·ªß s·ªë d∆∞', 'Vui l√≤ng n·∫°p/ki·∫øm th√™m ƒë·ªÉ mua', 'error');
      inventory.push(it); save(LS.inventory, inventory); addExp(20); renderContent();
    };
    grid.appendChild(el);
  });
  sec.appendChild(grid);
  c.appendChild(sec);
}

function renderInventory(c){
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML = `<div class="title">üéí Kho ƒë·ªì</div>`;
  const box=document.createElement('div'); box.className='inv-list';
  if(inventory.length===0){ box.innerHTML='<div class="muted">Ch∆∞a c√≥ v·∫≠t ph·∫©m n√†o.</div>'; }
  else inventory.forEach(it=>{ const chip=document.createElement('div'); chip.className='inv-chip'; chip.textContent=it.name; box.appendChild(chip); });
  sec.appendChild(box); c.appendChild(sec);
}

function renderWallet(c){
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML = `<div class="title">üí∞ S·ªë d∆∞ & R√∫t ti·ªÅn</div>`;
  const bal=document.createElement('div'); bal.className='card'; bal.innerHTML = `<div><b>S·ªë d∆∞ hi·ªán t·∫°i:</b> ${fmt(balance)} VNƒê</div>`;
  const form=document.createElement('div'); form.className='card mt10';
  form.innerHTML = `
    <div class="row">
      <div><b>R√∫t ti·ªÅn</b></div>
      <div class="muted">T·ªëi thi·ªÉu 50,000 VNƒê</div>
    </div>
    <div class="mt8"><input id="wAmount" type="number" placeholder="Nh·∫≠p s·ªë ti·ªÅn mu·ªën r√∫t" style="width:100%; padding:10px; border-radius:10px; border:1px solid rgba(0,0,0,.12)"></div>
    <div class="mt8">
      <select id="wBank" style="width:100%; padding:10px; border-radius:10px; border:1px solid rgba(0,0,0,.12)">
        <option>Vietcombank</option><option>VietinBank</option><option>BIDV</option><option>Agribank</option><option>Techcombank</option><option>Sacombank</option><option>VPBank</option>
      </select>
    </div>
    <div class="right mt10"><button class="action" id="wBtn">R√∫t</button></div>
  `;
  sec.appendChild(bal); sec.appendChild(form); c.appendChild(sec);
  form.querySelector('#wBtn').onclick=()=>{
    const amount=parseInt(form.querySelector('#wAmount').value,10)||0; const bank=form.querySelector('#wBank').value;
    if(amount<50000) return showToast('S·ªë ti·ªÅn kh√¥ng h·ª£p l·ªá','T·ªëi thi·ªÉu 50,000 VNƒê','error');
    if(balance<amount) return showToast('Kh√¥ng ƒë·ªß s·ªë d∆∞','Vui l√≤ng r√∫t s·ªë ti·ªÅn nh·ªè h∆°n','error');
    if(updateBalance(-amount, `R√∫t v·ªÅ ${bank}`)){
      withdrawHistory.unshift({ time: nowVN(), bank, amount }); if(withdrawHistory.length>50) withdrawHistory.pop(); save(LS.withdraw, withdrawHistory); renderContent();
    }
  };
}

function renderTx(c){
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML = `<div class="title">üßæ L·ªãch s·ª≠ giao d·ªãch</div>`;
  const table=document.createElement('table'); table.className='table';
  table.innerHTML = `<thead><tr><th>Th·ªùi gian</th><th>L√Ω do</th><th class="right">S·ªë ti·ªÅn</th></tr></thead><tbody></tbody>`;
  const tbody=table.querySelector('tbody');
  if(transactions.length===0){ const tr=document.createElement('tr'); tr.innerHTML='<td colspan="3">Ch∆∞a c√≥ giao d·ªãch.</td>'; tbody.appendChild(tr); }
  else transactions.slice(0,50).forEach(tx=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${tx.time}</td><td>${tx.reason||''}</td><td class="right">${tx.amount>0?'+':''}${fmt(tx.amount)} VNƒê</td>`; tbody.appendChild(tr); });
  sec.appendChild(table); c.appendChild(sec);
}

function renderWithdrawHistory(c){
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML = `<div class="title">üè¶ L·ªãch s·ª≠ r√∫t</div>`;
  const table=document.createElement('table'); table.className='table';
  table.innerHTML = `<thead><tr><th>Th·ªùi gian</th><th>Ng√¢n h√†ng</th><th class="right">S·ªë ti·ªÅn</th></tr></thead><tbody></tbody>`;
  const tbody=table.querySelector('tbody');
  if(withdrawHistory.length===0){ const tr=document.createElement('tr'); tr.innerHTML='<td colspan="3">Ch∆∞a c√≥ giao d·ªãch r√∫t.</td>'; tbody.appendChild(tr); }
  else withdrawHistory.slice(0,50).forEach(tx=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${tx.time}</td><td>${tx.bank}</td><td class="right">${fmt(tx.amount)} VNƒê</td>`; tbody.appendChild(tr); });
  sec.appendChild(table); c.appendChild(sec);
}

function renderProfile(c){
  const sec=document.createElement('div'); sec.className='section';
  const lvl=level(); const next=(lvl*1000) - (user.exp||0) + ((lvl-1)*1000);
  const need = (lvl*1000) - (user.exp||0);
  const pct = Math.max(0, Math.min(100, ((user.exp||0)%1000)/10));
  sec.innerHTML = `<div class="title">üë§ H·ªì s∆°</div>`;
  const card=document.createElement('div'); card.className='card';
  card.innerHTML = `
    <div class="row"><div><b>T√™n hi·ªÉn th·ªã</b></div></div>
    <div class="mt8"><input id="nameInp" value="${user.name||'Kh√°ch'}" style="width:100%; padding:10px; border-radius:10px; border:1px solid rgba(0,0,0,.12)"></div>
    <div class="right mt10"><button class="action" id="saveName">L∆∞u</button></div>
  `;
  const card2=document.createElement('div'); card2.className='card mt10';
  card2.innerHTML = `<div><b>C·∫•p:</b> Lvl ${lvl}</div><div class="progress mt8"><div style="width:${pct}%"></div></div><div class="mt8 muted">C√≤n ${fmt(1000 - ((user.exp||0)%1000))} EXP l√™n c·∫•p ti·∫øp theo</div>`;
  sec.appendChild(card); sec.appendChild(card2); c.appendChild(sec);
  card.querySelector('#saveName').onclick=()=>{ user.name = card.querySelector('#nameInp').value.trim()||'Kh√°ch'; save(LS.user, user); showToast('C·∫≠p nh·∫≠t h·ªì s∆°','ƒê√£ l∆∞u t√™n hi·ªÉn th·ªã','success'); renderContent(); };
}

function renderRedeem(c){
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML = `<div class="title">üîë Nh·∫≠p m√£</div>`;
  const input=document.createElement('input'); input.placeholder='Nh·∫≠p m√£: GOGO100, BONUS50, LITE20'; input.style.cssText='width:100%; padding:10px; border-radius:10px; border:1px solid rgba(0,0,0,.12)';
  const btn=document.createElement('button'); btn.className='action mt10'; btn.textContent='Nh·∫≠n th∆∞·ªüng';
  btn.onclick=()=>{
    const code=input.value.trim().toUpperCase(); if(!code) return;
    const table={ GOGO100:100000, BONUS50:50000, LITE20:20000 };
    if(!table[code]) return showToast('M√£ kh√¥ng h·ª£p l·ªá','Vui l√≤ng th·ª≠ l·∫°i','error');
    if(codes[code]) return showToast('ƒê√£ s·ª≠ d·ª•ng','M√£ n√†y b·∫°n ƒë√£ nh·∫≠n tr∆∞·ªõc ƒë√≥','error');
    codes[code]=true; save(LS.codes, codes);
    updateBalance(table[code], `Nh·∫≠p m√£ ${code}`); addExp(60); markQuestToday('code'); renderContent();
  };
  sec.appendChild(input); sec.appendChild(btn); c.appendChild(sec);
}

function renderLeaderboard(c){
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML = `<div class="title">üèÜ B·∫£ng x·∫øp h·∫°ng (demo)</div>`;
  const me = { name: user.name||'B·∫°n', score: (user.exp||0) + balance/1000 };
  const bots = [ {name:'Aqua',score:1200},{name:'Nova',score:980},{name:'Milo',score:760} ];
  const list=[me,...bots].sort((a,b)=>b.score-a.score);
  const table=document.createElement('table'); table.className='table';
  table.innerHTML='<thead><tr><th>H·∫°ng</th><th>T√™n</th><th class="right">ƒêi·ªÉm</th></tr></thead><tbody></tbody>';
  const tbody=table.querySelector('tbody');
  list.forEach((p,i)=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${i+1}</td><td>${p.name}</td><td class="right">${fmt(Math.round(p.score))}</td>`; tbody.appendChild(tr); });
  sec.appendChild(table); c.appendChild(sec);
}

/*************
 * Init load *
 *************/
renderHeader();
renderMainMenu();
renderSubTabs();
renderContent();
</script>
</body>
</html>