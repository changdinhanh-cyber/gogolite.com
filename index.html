<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>‚ö°Ô∏èGoGo Lite Premium</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer"/>
<style>
:root{
  --bg: linear-gradient(160deg,#212529 0%,#2c3243 42%,#343a40 72%,#495057 100%);
  --glass: rgba(255,255,255,.08);
  --radius: 18px;
  --brand: #ffd43b;
  --accent: #ff6b6b;
  --success: #51cf66;
  --info: #4dabf7;
  --warning: #ffd93d;
  --text: #f8f9fa;
  --blue: #4dabf7;
  --red: #fa5252;
  --support-green: #28a745; /* M√ÄU XANH L√Å M·ªöI CHO H·ªñ TR·ª¢ */
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family: Inter, sans-serif;
  background: var(--bg);
  display:flex; align-items:center; justify-content:center;
  animation: backgroundShift 20s ease infinite;
}
@keyframes backgroundShift {
    0% {background-position: 0% 50%;}
    50% {background-position: 100% 50%;}
    100% {background-position: 0% 50%;}
}
#app{
  width: 380px;
  height: 720px; border-radius: 26px; overflow:hidden; position:relative;
  box-shadow:0 20px 45px rgba(0,0,0,.5);
  display:flex; flex-direction:column;
  background: rgba(0,0,0,.6);
  color: var(--text);
}
/* ===== Header ===== */
.header{
  background: rgba(0,0,0,.5);
  backdrop-filter: blur(10px) saturate(140%);
  padding: 10px; position:relative; z-index:3;
  box-shadow: 0 6px 18px rgba(0,0,0,.25);
}
.brand{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
.brand-title{
  font-weight:900; font-size:22px;
  background:linear-gradient(270deg,#fff,#ffe66d,#ff6b6b,#fff);
  background-size:600% 600%;
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  animation: shift 7s ease infinite;
}
@keyframes shift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.balance-chip{
  background: rgba(255,255,255,.1); padding:6px 12px; border-radius:999px; font-weight:800;
  display:flex; gap:6px; align-items:center; box-shadow:0 2px 6px rgba(0,0,0,.2);
  cursor: pointer; /* TH√äM CON TR·ªé CHU·ªòT CHO D·ªÑ NH·∫¨N BI·∫æT */
}
.balance-chip i{color:#51cf66}

/* ===== Menu ƒë√£ ƒëi·ªÅu ch·ªânh ===== */
.main-menu{ 
  display:flex; 
  gap: 4px; 
  margin-top:8px;
  flex-wrap: nowrap;
  overflow-x: auto;
  padding-bottom: 5px;
}
.main-btn{
  flex:1; border:none; cursor:pointer; border-radius:14px; padding:8px 4px; 
  background: rgba(255,255,255,.1);
  backdrop-filter: blur(8px) saturate(140%);
  font-weight:700; display:flex; flex-direction: column;
  align-items:center;
  justify-content:center; gap:3px;
  transition:.15s; color: var(--text); 
  font-size:10px;
  min-width: 60px;
}
.main-btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.2); }
.main-btn.active{ background: var(--brand);
  box-shadow:0 6px 16px rgba(0,0,0,.3) }
.main-btn span {
    white-space: nowrap;
}
.main-btn .icon-wrapper {
  font-size: 18px;
  transition: transform 0.3s ease-in-out;
}
.main-btn:hover .icon-wrapper {
  animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
  transform: translate3d(0, 0, 0);
  backface-visibility: hidden;
  perspective: 1000px;
}
@keyframes shake {
  10%, 90% { transform: translate3d(-1px, 0, 0) rotate(-1deg);
  }
  20%, 80% { transform: translate3d(2px, 0, 0) rotate(2deg);
  }
  30%, 50%, 70% { transform: translate3d(-4px, 0, 0) rotate(-4deg);
  }
  40%, 60% { transform: translate3d(4px, 0, 0) rotate(4deg); }
}


/* ===== Sub Tabs ===== */
.subtabs{ display:flex; gap:8px; padding:8px;
  overflow-x:auto }
.subtab{
  border:none; padding:6px 14px; border-radius:999px; cursor:pointer; font-weight:700;
  background: rgba(255,255,255,.15);
  color: var(--text);
  white-space:nowrap;
}
.subtab.active{ background:var(--brand);
  color:#212529 }
/* CSS cho tab nh·∫≠p m√£ m√†u ƒë·ªè */
.subtab.active-redeem {
    background: var(--red);
    color: #fff;
    box-shadow: 0 6px 16px rgba(250, 82, 82, 0.4);
}
.subtab.active-redeem.active {
    background: var(--red);
    color: #fff;
    box-shadow: 0 6px 16px rgba(250, 82, 82, 0.4);
}
/* N√∫t nh·∫≠p m√£ m√†u ƒë·ªè */
.redeem-btn-red {
    background: var(--red) !important;
    color: #fff !important;
    box-shadow: 0 4px 12px rgba(250, 82, 82, 0.4);
    transition: all 0.3s ease;
}
.redeem-btn-red:hover {
    background: #c82333 !important; /* ƒê·ªè ƒë·∫≠m h∆°n khi hover */
    transform: translateY(-1px);
    box-shadow: 0 6px 16px rgba(250, 82, 82, 0.6);
}


/* ===== Content ===== */
.content{ flex:1; overflow:auto; padding:10px }
.section{
  background: rgba(255,255,255,.05);
  backdrop-filter: blur(10px) saturate(130%);
  border-radius: var(--radius); padding:12px;
  box-shadow: 0 8px 18px rgba(0,0,0,.3);
  animation: fadeIn .2s ease;
}
@keyframes fadeIn{from{opacity:0; transform:translateY(4px)} to{opacity:1;
  transform:none}}
.section + .section{ margin-top:12px }
.card{ background: rgba(0,0,0,.25);
  border-radius:14px; padding:12px; box-shadow:0 4px 12px rgba(0,0,0,.2); margin-top:8px }
.title{ font-weight:900; margin-bottom:8px;
  font-size:16px }

/* ===== Check-in grid ===== */
.week-grid{ display:grid; grid-template-columns: repeat(7,1fr);
  gap:6px }
.day{
  background: #343a40;
  color: var(--text);
  border-radius:12px; height:60px; display:flex;
  flex-direction:column;
  align-items:center; justify-content:center; font-weight:800; font-size:13px; cursor:pointer;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
  transition:.15s;
}
.day:hover{ transform:translateY(-2px); background:#495057 }
.day.checked{ background:#51cf66;
  color:#fff }
.day i { font-size: 20px; }

/* ===== Shop ===== */
.shop-grid{ display:grid; grid-template-columns:1fr 1fr;
  gap:10px }
.item{ background:rgba(255,255,255,.1);
border-radius:12px; padding:10px;
  box-shadow:0 3px 8px rgba(0,0,0,.12) }
.item h4{ margin:0 0 6px;
  font-size:14px }
.item .price{ font-weight:800 }

/* ===== Table ===== */
.table{ width:100%; border-collapse:collapse;
  margin-top:8px; }
.table th, .table td{ padding:6px; border-bottom:1px solid rgba(255,255,255,.1);
  font-size:13px }
.table th{ background:var(--brand); color:#212529;
  text-align:left }

/* ===== Toast / Coin ===== */
.coin{ position:absolute; width:18px; height:18px; background:gold; border-radius:50%; top:-20px;
  animation:fall linear forwards }
@keyframes fall{ to{ transform:translateY(860px) rotate(360deg); opacity:0 } }
.overlay{ position:fixed; inset:0; background:rgba(0,0,0,.6); backdrop-filter:blur(5px); display:flex; align-items:center; justify-content:center;
  z-index:9 }
.toast{ width:86%; max-width:340px; background:linear-gradient(145deg,#495057,#343a40); border-radius:18px; padding:16px; text-align:center; box-shadow:0 14px 40px rgba(0,0,0,.5); color: var(--text); }
.toast h3{ margin:6px 0 4px;
  font-size:18px }
.toast p{ margin:0; opacity:.85; font-size:13px }

/* Helpers */
.muted{ opacity:.6 } .center{text-align:center} .mt8{margin-top:8px} .mt10{margin-top:10px}

/* ====== CSS ph·ª• cho ph·∫ßn n√¢ng c·∫•p ====== */
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.stat{background:rgba(255,255,255,.1);border-radius:14px;padding:10px;box-shadow:0 3px 10px rgba(0,0,0,.2)}
.stat .big{font-weight:900;font-size:18px}
.progress{height:8px;background:rgba(255,255,255,.1);border-radius:999px;overflow:hidden}
.progress > div{height:100%;background:linear-gradient(90deg,#ffd43b,#ff6b6b);width:0%}
.row{display:flex;align-items:center;justify-content:space-between;gap:8px}
.chip{display:inline-flex;align-items:center;gap:6px;background:rgba(255,255,255,.1);border-radius:999px;padding:6px 10px;font-weight:700;box-shadow:0 3px 8px rgba(0,0,0,.2)}
.btn{border:none;border-radius:12px;padding:8px 10px;font-weight:800;cursor:pointer;background:#ffd43b}
.btn.secondary{background:rgba(255,255,255,.1)}
.modal{width:90%;max-width:360px;background:linear-gradient(145deg,#495057,#343a40);border-radius:16px;box-shadow:0 20px 50px rgba(0,0,0,.5);padding:14px;
  color: var(--text)}
.friend{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,.1);border-radius:12px;padding:10px;box-shadow:0 2px 8px rgba(0,0,0,.2)}
.avatar{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;background:var(--brand)}
.spin-wheel{width:240px;height:240px;border-radius:50%;margin:12px auto;border:10px solid var(--text);
  background: conic-gradient(#ffd43b 0 60deg,#74c0fc 60deg 120deg,#ff6b6b 120deg 180deg,#51cf66 180deg 240deg,#f783ac 240deg 300deg,#ffe066 300deg 360deg);position:relative}
.spin-pointer{position:absolute;left:50%;top:-18px;transform:translateX(-50%);width:0;height:0;border-left:16px solid transparent;border-right:16px solid transparent;border-bottom:26px solid #e03131}

/* New CSS for running text */
.running-text-container {
    overflow: hidden;
    white-space: nowrap;
    position: relative;
    padding: 4px 0;
    font-size: 11px;
    opacity: 0.8;
}
.running-text {
    display: inline-block;
    padding-left: 100%;
    animation: marquee 20s linear infinite;
    animation-delay: -5s; /* Start in the middle */
}
@keyframes marquee {
    0%   { transform: translate(0, 0);
    }
    100% { transform: translate(-100%, 0); }
}
/* New CSS for withdraw notification */
.withdraw-alert {
    position: fixed;
    bottom: 0;
    left: 100%;
    transform: translateX(0);
    background: #495057;
    color: #fff;
    padding: 8px 16px;
    border-radius: 999px;
    font-size: 13px;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(0,0,0,.2);
    z-index: 10;
    animation: slideAcross 10s linear forwards;
}
@keyframes slideAcross {
    0% { left: 100%; }
    100% { left: -100%;
    }
}
/* New CSS for sponsor logos */
.sponsor-logos {
    display: flex;
    justify-content: space-around;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
}
.sponsor-logos .sponsor-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,.1);
    background: rgba(255,255,255,.1);
    padding: 5px;
    object-fit: contain;
    font-size: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.footer-logos {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  padding: 10px;
  background: rgba(0,0,0,.5);
  border-top-left-radius: 18px;
  border-top-right-radius: 18px;
}
.footer-logos .gogo-logo {
  font-weight: 800;
  font-size: 16px;
  display: flex;
  align-items: center;
  gap: 4px;
  animation: shake 2s ease-in-out infinite;
}
@keyframes shake {
    0%, 100% { transform: translateX(0);
    }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-2px);
    }
    20%, 40%, 60%, 80% { transform: translateX(2px); }
}
.withdraw-btn {
  background: #dc3545;
  color: #fff;
  font-weight: bold;
  font-size: 16px;
  padding: 12px 20px;
  border-radius: 12px;
  width: 100%;
  border: none;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
  transition: all 0.3s ease;
}
.withdraw-btn:hover {
  background: #c82333;
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(220, 53, 69, 0.6);
}
.deposit-btn {
  background: #28a745;
  color: #fff;
  font-weight: bold;
  padding: 12px 20px;
  border-radius: 12px;
  width: 100%;
  border: none;
  cursor: pointer;
  margin-top: 10px;
}
.bank-info {
  display: flex;
  align-items: center;
  gap: 10px;
}
.bank-logo {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background: rgba(255,255,255,.15);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
}
input[type="number"] {
  font-size: 16px;
  background-color: rgba(255,255,255,.1);
  border: none;
  color: var(--text);
  border-radius: 8px;
}
.action-btn-quest {
    background: #ffd43b;
    color: #212529;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    padding: 6px 12px;
    cursor: pointer;
    transition: 0.2s;
}
.action-btn-quest:hover {
    background: #ffc107;
}

/* CSS cho tr√≤ ch∆°i Xanh ƒê·ªè */
.game-container { text-align: center;
}
.timer-display { font-size: 48px; font-weight: 900; }
.bet-options { display: flex; justify-content: space-around; margin: 15px 0; }
.bet-btn { padding: 12px 24px;
  font-size: 16px; font-weight: 800; color: #fff; border: none; border-radius: 12px; cursor: pointer; }
.bet-btn.blue { background-color: var(--blue); }
.bet-btn.red { background-color: var(--red);
}
.bet-input-wrapper { margin: 10px 0; }
.result-history { display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; margin-top: 10px;
}
.result-item { width: 24px; height: 24px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 12px; color: #fff; font-weight: bold;
}
.result-item.blue { background-color: var(--blue); }
.result-item.red { background-color: var(--red); }

/* M·ªöI: CSS cho Ch·∫µn L·∫ª */
.even-odd-game { text-align: center;
}
.even-odd-display { 
    font-size: 36px; 
    font-weight: 900; 
    color: var(--brand); 
    margin: 10px 0; 
    border-radius: 10px;
    background: rgba(255,255,255,.08);
  padding: 10px;
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.even-odd-bet-options { display: flex; justify-content: space-around; gap: 10px; margin-top: 15px;
}
.even-odd-btn {
    padding: 12px 20px;
    font-size: 16px;
    font-weight: 800;
    color: #fff;
    border: none;
    border-radius: 12px;
    cursor: pointer;
  flex: 1;
}
.even-odd-btn.even { background-color: #74c0fc; } /* M√†u xanh nh·∫°t h∆°n blue */
.even-odd-btn.odd { background-color: #ff6b6b;
} /* M√†u ƒë·ªè */
.even-odd-result-history { display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; margin-top: 10px;
}
.even-odd-result-item {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
  font-weight: bold;
    color: #fff;
}
.even-odd-result-item.even { background-color: #74c0fc; }
.even-odd-result-item.odd { background-color: #ff6b6b;
}


/* CSS cho tr√≤ ch∆°i XO */
.xo-board {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  width: 240px;
  height: 240px;
  margin: 10px auto;
  background: #343a40;
  border-radius: 10px;
  overflow: hidden;
  gap: 4px;
  padding: 4px;
}
.xo-cell {
  background: #495057;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 48px;
  font-weight: 900;
  color: #fff;
  cursor: pointer;
  transition: 0.2s;
}
.xo-cell:hover {
  background: #6c757d;
}
.xo-cell.X { color: var(--blue); }
.xo-cell.O { color: var(--red); }

.contact-info {
  font-size: 12px;
  opacity: 0.8;
}
.active-users {
  text-align: center;
  font-weight: bold;
  font-size: 14px;
  margin-top: 10px;
}
.running-withdraw-alert {
  position: absolute;
  bottom: 0;
  left: 100%;
  transform: translateX(0);
  background: #495057;
  color: #fff;
  padding: 8px 16px;
  border-radius: 999px;
  font-size: 13px;
  font-weight: 600;
  box-shadow: 0 4px 12px rgba(0,0,0,.2);
  z-index: 10;
  animation: slideAcross 10s linear forwards;
}
@keyframes slideAcross {
    0% { left: 100%;
    }
    100% { left: -100%;
    }
}

/* ===== MODIFIED CHATBOT CSS - CHUY·ªÇN SANG G√ìC D∆Ø·ªöI B√äN TR√ÅI V√Ä ƒê·ªîI M√ÄU ===== */
.chat-container-wrapper {
  position: fixed;
  bottom: 20px;
  left: 20px; /* CHUY·ªÇN SANG TR√ÅI */
  right: auto;
  display: flex;
  gap: 10px;
  z-index: 1000;
}
.chat-bubble {
  position: static; 
  cursor: grab;
}
.contact-bubble {
  position: static;
}

.chat-bubble.dragging {
  cursor: grabbing;
}
.chat-btn, .contact-btn {
  /* D√πng chung style c∆° b·∫£n */
  border: none;
  padding: 6px 10px;
  border-radius: 12px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  transition: transform 0.2s;
  font-size: 10px;
  font-weight: 600;
  text-align: center;
  width: 40px;
  height: 40px;
  line-height: 1;
}
.chat-btn {
  background: var(--blue); /* M√ÄU XANH D∆Ø∆†NG CHO CHAT */
  color: white;
}
.contact-btn {
  background: var(--support-green); /* M√ÄU XANH L√Å ƒê·∫¨M CHO H·ªñ TR·ª¢ */
  color: white;
}

.chat-btn:hover, .contact-btn:hover {
  transform: scale(1.05);
}
.chat-window {
  position: fixed;
  bottom: 80px;
  left: 20px; /* ƒê·∫∑t c·ª≠a s·ªï chat ·ªü b√™n tr√°i */
  right: auto;
  width: 320px;
  height: 400px;
  background: #212529;
  border-radius: 18px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  transform: scale(0);
  transform-origin: bottom left; /* ƒêi·ªÅu ch·ªânh g·ªëc transform */
  transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
}
.chat-window.open {
  transform: scale(1);
}
.chat-header .close-chat {
  background: none;
  border: none;
  color: #fff;
  font-size: 20px;
  cursor: pointer;
}
.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.chat-input {
  display: flex;
  padding: 8px;
  background: #343a40;
}
.chat-input input {
  flex: 1;
  border: none;
  background: #495057;
  color: var(--text);
  padding: 8px 12px;
  border-radius: 999px;
}
.chat-input button {
  background: var(--brand);
  border: none;
  color: #212529;
  padding: 0 16px;
  margin-left: 8px;
  border-radius: 999px;
  font-weight: 700;
  cursor: pointer;
}
.message {
  padding: 8px 12px;
  border-radius: 14px;
  max-width: 80%;
}
.message.bot {
  background: #343a40;
  align-self: flex-start;
}
.message.user {
  background: var(--blue); /* M√ÄU XANH D∆Ø∆†NG CHO TIN NH·∫ÆN USER */
  align-self: flex-end;
}

/* ===== CRYPTO CSS ===== */
.crypto-chart {
  background: #2c3243;
  border-radius: 12px;
  padding: 12px;
  height: 200px;
  position: relative;
  overflow: hidden;
}
.chart-price {
  font-size: 32px;
  font-weight: 900;
  margin: 0;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
.price-up { color: #51cf66; }
.price-down { color: #ff6b6b; }
.crypto-actions {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.crypto-actions .btn {
  width: 100%;
}
.buy-btn { background: #51cf66; color: #212529;
}
.sell-btn { background: #ff6b6b; color: #212529;
}
/* NEW CSS for pending deposit */
.pending-deposit-alert {
  background: rgba(255, 255, 255, 0.1);
  padding: 8px;
  border-radius: 8px;
  margin-top: 8px;
  font-size: 13px;
  display: flex;
  align-items: center;
  gap: 8px;
  animation: pulse 1.5s infinite;
}
@keyframes pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(255, 212, 59, 0.4);
    }
    70% {
        box-shadow: 0 0 0 10px rgba(255, 212, 59, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(255, 212, 59, 0);
    }
}

/* New CSS for Login Page */
.login-container {
    /* ƒê√É S·ª¨A: Th√™m CSS cho vi·ªÅn Galaxy ch·∫°y */
    position: relative; /* Quan tr·ªçng cho pseudo-element */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 24px;
    background: rgba(0,0,0,.6);
    backdrop-filter: blur(10px);
    border-radius: 26px;
    box-shadow: 0 20px 45px rgba(0,0,0,.5);
    width: 380px;
    height: 720px;
    color: var(--text);
    overflow: hidden; /* ƒê·ªÉ vi·ªÅn ch·∫°y kh√¥ng tr√†n ra ngo√†i */
    /* Lo·∫°i b·ªè box-shadow ƒë·ªÉ d√πng cho pseudo-element */
    box-shadow: none; 
}
/* PSEUDO-ELEMENT CHO VI·ªÄN GRADIENT C·ªê ƒê·ªäNH */
.login-container::before {
    content: "";
    position: absolute;
    inset: -2px; 
    border-radius: 28px; 
    background: conic-gradient(
        from 0deg, 
        #ffd43b, 
        #ff6b6b, 
        #4dabf7, 
        #51cf66, 
        #ffd43b
    );
    z-index: -1;
    /* ƒê√£ lo·∫°i b·ªè animation: rotateBorder 4s linear infinite; */
    padding: 5px; /* TƒÉng padding ƒë·ªÉ vi·ªÅn ƒë·∫≠m h∆°n (5px thay v√¨ 3px) */
    /* Che ph·ªß b√™n trong b·∫±ng m√†u n·ªÅn c·ªßa container */
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
}
/* ƒê√£ lo·∫°i b·ªè @keyframes rotateBorder */

.login-title {
    font-size: 32px;
    font-weight: 900;
    margin-bottom: 24px;
    background:linear-gradient(270deg,#fff,#ffe66d,#ff6b6b,#fff);
    background-size:600% 600%;
    -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    animation: shift 7s ease infinite;
}
.login-input {
    width: 100%;
    padding: 12px;
    margin-bottom: 16px;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid transparent; /* Vi·ªÅn ban ƒë·∫ßu trong su·ªët */
    border-radius: 12px;
    color: var(--text);
    font-size: 16px;
    transition: border-color 0.3s;
}
/* ƒê√É S·ª¨A: Hi·ªáu ·ª©ng vi·ªÅn m√†u v√†ng khi focus */
.login-input:focus {
    outline: none;
    border-color: var(--brand); /* M√†u v√†ng khi focus */
    box-shadow: 0 0 10px rgba(255, 212, 59, 0.5); /* Th√™m box-shadow nh·∫π */
}

.login-btn {
    width: 100%;
    padding: 12px;
    background: var(--brand);
    color: #212529;
    border: none;
    border-radius: 12px;
    font-size: 18px;
    font-weight: 800;
    cursor: pointer;
    transition: 0.2s;
}
.login-btn:hover {
    background: #ffc107;
}

/* M·ªöI: CSS cho ph·∫ßn x√°c nh·∫≠n n·∫°p ti·ªÅn nh·∫•p nh√°y */
.deposit-confirmation-section {
    background: var(--red); 
    border: 3px solid var(--red);
    box-shadow: 0 0 15px rgba(250, 82, 82, 0.8);
    color: #fff;
    animation: flashRed 1s ease infinite alternate;
}

@keyframes flashRed {
    0% {
        box-shadow: 0 0 8px rgba(250, 82, 82, 0.6), 0 0 0 rgba(250, 82, 82, 0.4);
        transform: scale(1);
    }
    100% {
        box-shadow: 0 0 15px rgba(250, 82, 82, 1), 0 0 25px rgba(250, 82, 82, 0.6);
        transform: scale(1.01);
    }
}
/* CSS cho n√∫t Copy */
.copy-btn {
    background: var(--info);
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 4px 8px;
    font-weight: 600;
    cursor: pointer;
    font-size: 12px;
    margin-left: 8px;
    transition: background 0.2s;
}
.copy-btn:hover {
    background: #36a4f5;
}
</style>
</head>
<body>

<div class="login-container" id="loginContainer">
    <div class="login-title">üöÄ GoGo Lite Premium</div>
    <input type="text" id="usernameInput" class="login-input" placeholder="T√™n t√†i kho·∫£n">
    <input type="password" id="passwordInput" class="login-input" placeholder="M·∫≠t kh·∫©u">
    <input type="text" id="referralCodeInput" class="login-input" placeholder="M√£ gi·ªõi thi·ªáu">
    <input type="text" id="tiktokIdInput" class="login-input" placeholder="ID TikTok">
    <button id="loginBtn" class="login-btn">ƒêƒÉng nh·∫≠p</button>
</div>

<div id="app" style="display: none;">
  <div class="header">
    <div class="brand">
      <div class="brand-title">üöÄ GoGo Lite Premium</div>
      <div class="balance-chip" id="balanceChip">
        <i class="fa-solid fa-coins"></i>
        <span id="balanceText">‚Äî</span>
      </div>
    </div>
    <div class="main-menu" id="mainMenu"></div>
  </div>
  <div class="running-text-container">
    <div class="running-text">Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi GoGo Lite Premium!
  Ch√∫c b·∫°n c√≥ m·ªôt ng√†y ki·∫øm ti·ªÅn vui v·∫ª! ‚ú®</div>
  </div>
  <div class="subtabs" id="subTabs"></div>
  <div class="content" id="content"></div>
  <div class="running-withdraw-alert">
    <div class="running-withdraw-text" id="withdrawAlertText"></div>
  </div>
  <div class="footer-logos">
    <div class="gogo-logo">
      GGL <i class="fa-solid fa-sack-dollar"></i>
    </div>
  </div>
</div>

<div class="chat-container-wrapper">
  <div class="contact-bubble">
    <button class="contact-btn" id="contactButton" title="Li√™n h·ªá h·ªó tr·ª£ Telegram">
      <i class="fa-solid fa-phone"></i>
      <span>H·ªó tr·ª£</span>
    </button>
  </div>
  <div class="chat-bubble">
    <button class="chat-btn" id="chatButton">
      <i class="fa-solid fa-comments"></i>
      <span>GGL Chat</span>
    </button>
    <div class="chat-window" id="chatWindow">
      <div class="chat-header">
        <span>GGL Chat</span>
        <button class="close-chat" id="closeChat">&times;</button>
      </div>
      <div class="chat-messages" id="chatMessages"></div>
      <div class="chat-input">
        <input type="text" id="chatInput" placeholder="Nh·∫≠p tin nh·∫Øn..." />
        <button id="sendChat">G·ª≠i</button>
      </div>
    </div>
  </div>
</div>
<script>
/********************
 * State & Utilities *
 ********************/
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);
const fmt = n => (n||0).toLocaleString('vi-VN');
const LS = {
  // balance: 'gogo.balance', // KH√îNG D√ôNG N·ªÆA
  tx: 'gogo.transactions',
  withdraw: 'gogo.withdraws',
  user: 'gogo.user',
  inventory: 'gogo.inventory',
  codes: 'gogo.codes',
  checkin: 'gogo.checkin',
  quests: 'gogo.quests',
  bank: 'gogo.bank',
  blueRed: 'gogo.blueRed',
  xo: 'gogo.xo',
  crypto: 'gogo.crypto',
  pendingDeposit: 'gogo.pendingDeposit',
  isLoggedIn: 'gogo.isLoggedIn',
  evenOdd: 'gogo.evenOdd',
  mineLastTime: 'gogo.mineLastTime'
};
// init state
// S·ª¨A: Chia balance th√†nh hai d·∫°ng kh·∫£ d·ª•ng v√† ƒë√≥ng bƒÉng
let availableBalance = parseInt(localStorage.getItem('gogo.availableBalance') || '0', 10); // Ti·ªÅn th·∫Øng game, c√≥ th·ªÉ r√∫t
let frozenBalance = parseInt(localStorage.getItem('gogo.frozenBalance') || '0', 10);     // Ti·ªÅn n·∫°p/nhi·ªám v·ª•, kh√¥ng th·ªÉ r√∫t
let balance = availableBalance + frozenBalance; // T·ªïng s·ªë d∆∞ (ch·ªâ ƒë·ªÉ hi·ªÉn th·ªã)

let transactions = JSON.parse(localStorage.getItem(LS.tx) || '[]');
let withdrawHistory = JSON.parse(localStorage.getItem(LS.withdraw) || '[]');
// S·ª¨A: TH√äM phone v√† email v√†o user m·∫∑c ƒë·ªãnh
let user = JSON.parse(localStorage.getItem(LS.user) || '{"name":"Kh√°ch","exp":0,"avatar":"üü°", "phone": "", "email": ""}');
let inventory = JSON.parse(localStorage.getItem(LS.inventory) || '[]');
let codes = JSON.parse(localStorage.getItem(LS.codes) || '{}');
let checkin = JSON.parse(localStorage.getItem(LS.checkin) || '{}');
let quests = JSON.parse(localStorage.getItem(LS.quests) || '{}');
let linkedBank = JSON.parse(localStorage.getItem(LS.bank) || 'null');
let blueRed = JSON.parse(localStorage.getItem(LS.blueRed) || '{"history":[], "bet":0, "side": null}');
let xoState = JSON.parse(localStorage.getItem(LS.xo) || '{"wins":0, "losses":0, "draws":0}');
let cryptoState = JSON.parse(localStorage.getItem(LS.crypto) || '{"coinBalance": 0, "investedVND": 0}');
let pendingDeposit = load(LS.pendingDeposit) || null;
let evenOdd = JSON.parse(localStorage.getItem(LS.evenOdd) || '{"history":[], "bet":0, "side": null}');
let isLoggedIn = localStorage.getItem(LS.isLoggedIn) === 'true';
let mineLastTime = parseInt(localStorage.getItem(LS.mineLastTime) || '0', 10);

function save(k,v){ localStorage.setItem(k, typeof v==='string'? v : JSON.stringify(v));
}
function load(k){ try { return JSON.parse(localStorage.getItem(k));
} catch { return null; }}
function saveAll(){
  // B·∫ÆT BU·ªòC: L∆∞u tr·ªØ 2 lo·∫°i ti·ªÅn ri√™ng bi·ªát
  save('gogo.availableBalance', String(availableBalance));
  save('gogo.frozenBalance', String(frozenBalance));
  
  save(LS.tx, transactions);
  save(LS.withdraw, withdrawHistory);
  save(LS.user, user); // ƒê√£ bao g·ªìm phone v√† email
  save(LS.inventory, inventory);
  save(LS.codes, codes);
  save(LS.checkin, checkin);
  save(LS.quests, quests);
  save(LS.bank, linkedBank);
  save(LS.blueRed, blueRed);
  save(LS.xo, xoState);
  save(LS.crypto, cryptoState);
  save(LS.pendingDeposit, pendingDeposit);
  save(LS.evenOdd, evenOdd);
  save(LS.mineLastTime, String(mineLastTime));
}

function nowVN(){ return new Date().toLocaleString('vi-VN');
}
function todayKey(){ const d=new Date(); return d.toISOString().slice(0,10);
}
function weekKey(){
  const d = new Date();
  const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
  date.setUTCDate(date.getUTCDate() + 4 - (date.getUTCDay()||7));
  const yearStart = new Date(Date.UTC(date.getUTCFullYear(),0,1));
  const weekNo = Math.ceil((((date - yearStart) / 86400000) + 1)/7);
  return `${date.getUTCFullYear()}-W${weekNo}`;
}

function ensureCheckinWeek(){
  const wk = weekKey();
  if(!checkin.weekKey || checkin.weekKey !== wk){
    checkin = { weekKey: wk, days: [], bonusClaimedWeeks: (checkin.bonusClaimedWeeks||[]) };
  save(LS.checkin, checkin);
  }
}

function level(){ return Math.floor((user.exp||0)/1000) + 1; }
function addExp(x){ user.exp = (user.exp||0) + x; save(LS.user, user); renderHeader();
}

// balance & effects
// S·ª¨A ƒê·ªîI L·ªöN: Th√™m tham s·ªë type ƒë·ªÉ ph√¢n bi·ªát ti·ªÅn (M·∫∑c ƒë·ªãnh l√† 'frozen')
function updateBalance(amount, reason, type = 'frozen'){
  let currentBalance = availableBalance + frozenBalance;
  const newBal = currentBalance + amount;
  if(newBal < 0) return false;

  if (amount > 0) {
    if (type === 'available') {
      availableBalance += amount;
    } else { 
      // N·∫°p ti·ªÅn, nhi·ªám v·ª•, ƒëi·ªÉm danh, code -> ƒê√≥ng bƒÉng
      frozenBalance += amount;
    }
  } else if (amount < 0) {
    // Logic Tr·ª´ ti·ªÅn (C∆∞·ª£c/Mua/R√∫t): ∆Øu ti√™n tr·ª´ Kh·∫£ d·ª•ng tr∆∞·ªõc, sau ƒë√≥ ƒë·∫øn ƒê√≥ng bƒÉng.
    let remainingAmount = Math.abs(amount);
    
    if (availableBalance >= remainingAmount) {
      availableBalance -= remainingAmount;
    } else {
      // Tr·ª´ h·∫øt kh·∫£ d·ª•ng, sau ƒë√≥ tr·ª´ ph·∫ßn c√≤n l·∫°i t·ª´ ƒë√≥ng bƒÉng
      remainingAmount -= availableBalance;
      frozenBalance -= remainingAmount;
    }
  }
  
  // C·∫≠p nh·∫≠t t·ªïng s·ªë d∆∞ (ch·ªâ ƒë·ªÉ hi·ªÉn th·ªã)
  balance = availableBalance + frozenBalance; 

  transactions.unshift({ time: nowVN(), amount, reason });
  if(transactions.length>200) transactions.pop();
  saveAll();
  renderHeader();
  popMoney(`${amount>0?'+':''}${fmt(amount)} VNƒê\n${reason||''}`);
  return true;
}

function popMoney(message){
  for(let i=0;i<10;i++){
    const coin=document.createElement('div');
    coin.className='coin';
    coin.style.left=(Math.random()*340+10)+'px';
    coin.style.animationDuration=(Math.random()*1.2+1.4)+'s';
    document.body.appendChild(coin);
    setTimeout(()=>coin.remove(), 2400);
  }
  showToast('Th√†nh c√¥ng', message, 'success');
}
// S·ª¨A: H√†m showToast ƒë·ªÉ ch·∫•p nh·∫≠n HTML content cho desc
function showToast(title, desc, type='info'){
  const overlay=document.createElement('div'); overlay.className='overlay';
  const box=document.createElement('div'); box.className='toast';
  const icon = type==='success'? 'üí∏' : type==='error'? '‚ùå' : '‚ÑπÔ∏è';
  box.innerHTML = `<div style="font-size:40px">${icon}</div>
    <h3>${title}</h3><p>${desc||''}</p>
    <div style="margin-top:10px"><button onclick="this.closest('.overlay').remove()">ƒê√≥ng</button></div>`;
  overlay.appendChild(box); document.body.appendChild(overlay);
  setTimeout(()=>{ if(document.body.contains(overlay)) overlay.remove(); }, 2600);
}

// Function to show withdraw alert
function showWithdrawAlert(user, amount) {
  const alertText = `üéâ ${user} v·ª´a r√∫t ${fmt(amount)} VNƒê!`;
  const alertElement = document.createElement('div');
  alertElement.className = 'running-withdraw-text';
  alertElement.textContent = alertText;

  const container = $('.running-withdraw-alert');
  if (container) {
    container.innerHTML = ''; // Clear previous alerts
    container.appendChild(alertElement);
  }
}
/****************
 * Menu / Tabs  *
 ****************/
const MAIN = {
  home:   { label:'Trang ch·ªß', emoji:'üè†', subtabs:['T·ªïng quan', 'L∆∞u √Ω', 'C·∫•p VIP'] }, 
  checkin:{ label:'ƒêi·ªÉm danh', emoji:'üóìÔ∏è', subtabs:['ƒêi·ªÉm danh tu·∫ßn','Bonus tu·∫ßn', 'Nh·∫≠p m√£'] }, 
  quests: { label:'Nhi·ªám v·ª•', emoji:'üéØ', subtabs:['Daily','Weekly'] },
  game: { label:'Mini game', emoji:'üéÆ', subtabs:['V√≤ng quay','H·ªôp qu√†','Xanh ƒê·ªè','XO', 'Ch·∫µn L·∫ª'] }, 
  crypto: { label:'Crypto', emoji: 'üöÄ', subtabs:['Giao d·ªãch', 'ƒê√†o Xu'] },
  shop:   { label:'Shop', emoji:'üõç', subtabs:['C·ª≠a h√†ng','Kho ƒë·ªì'] },
  wallet: { label:'V√≠ & L·ªãch s·ª≠', emoji:'üí∞', subtabs:['S·ªë d∆∞','Giao d·ªãch','L·ªãch s·ª≠ r√∫t', 'N·∫°p ti·ªÅn'] },
  
  community: { label:'C·ªông ƒë·ªìng', emoji:'üë•', subtabs:['B·∫°n b√®'] },
 
  profile:{ label:'C√° nh√¢n', emoji:'üßë‚Äçüíª', subtabs:['H·ªì s∆°','BXH'] }, 
};
let currentMain = 'home';
let currentSubIndex = 0;

// TH√äM: H√†m hi·ªÉn th·ªã chi ti·∫øt s·ªë d∆∞ khi click v√†o chip
function showBalanceDetails(){
  const detailHTML = `
    <div style="text-align: left; font-size: 14px;">
        <div style="font-weight: bold; margin-bottom: 8px;">Chi ti·∫øt S·ªë d∆∞ c·ªßa b·∫°n:</div>
        <div style="
            background: rgba(255, 255, 255, 0.1); 
            padding: 10px; 
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,.2);">
            
            <div style="margin-bottom: 6px;">
                <span style="font-weight: bold;">Kh·∫£ d·ª•ng | </span> 
                <span style="float: right; color: var(--success); font-weight: 800;">${fmt(availableBalance)} VNƒê</span>
            </div>
            
            <div style="border-top: 1px solid rgba(255,255,255,.1); padding-top: 6px;">
                <span style="font-weight: bold;">ƒê√≥ng bƒÉng | </span> 
                <span style="float: right; color: var(--info); font-weight: 800;">${fmt(frozenBalance)} VNƒê</span>
            </div>
        </div>
        <p style="font-size: 11px; opacity: 0.7; margin-top: 12px; text-align: center;">
            *ƒê√¢y l√† t·ªïng ti·ªÅn c·ªßa t√†i kho·∫£n , r√∫t gi√° tr·ªã kh·∫£ d·ª•ng m·ªõi th√†nh c√¥ng .
        </p>
    </div>
  `;
  showToast('T·ªïng S·ªë D∆∞: ' + fmt(balance) + ' VNƒê', detailHTML, 'info');
}

function renderHeader(){
  // C·∫≠p nh·∫≠t t·ªïng s·ªë d∆∞
  balance = availableBalance + frozenBalance; 
  $('#balanceText').textContent = fmt(balance) + ' VNƒê';

  // TH√äM: G√°n s·ª± ki·ªán click cho chip s·ªë d∆∞
  const chip = $('#balanceChip');
  if (chip) {
      chip.onclick = showBalanceDetails;
  }
}

function renderMainMenu(){
  const mm = $('#mainMenu'); mm.innerHTML='';
  Object.entries(MAIN).forEach(([key, cfg])=>{
    const b=document.createElement('button'); b.className='main-btn'+(key===currentMain?' active':'');
    b.innerHTML = `<span class="icon-wrapper">${cfg.emoji}</span><span>${cfg.label}</span>`;
    b.onclick=()=>{ currentMain = key; currentSubIndex = 0; renderSubTabs(); renderContent(); };
    mm.appendChild(b);
  });
}

function renderSubTabs(){
  const st = $('#subTabs'); st.innerHTML='';
  MAIN[currentMain].subtabs.forEach((name, i)=>{
    const b=document.createElement('button'); 
    b.className='subtab'+(i===currentSubIndex?' active':''); 

    // Th√™m class m√†u ƒë·ªè cho tab Nh·∫≠p m√£
    if (currentMain === 'checkin' && name === 'Nh·∫≠p m√£') {
        b.className += ' active-redeem';
    }
    // ƒê·∫£m b·∫£o tab ƒë∆∞·ª£c ch·ªçn v·∫´n c√≥ class 'active'
    if (i === currentSubIndex) {
        b.className += ' active';
    }


   
  b.textContent=name;
    b.onclick=()=>{ currentSubIndex=i; renderContent(); };
    st.appendChild(b);
  });
}
/****************
 * Renderers     *
 ********************/
function renderContent(){
  const c = $('#content'); c.innerHTML='';
  const sub = MAIN[currentMain].subtabs[currentSubIndex];
  if(currentMain==='home'){
    if(sub === 'T·ªïng quan') {
      renderHomeOverview(c);
    }
    else if(sub === 'L∆∞u √Ω') { 
        renderHomeNotes(c);
    }
    else if(sub === 'C·∫•p VIP') { 
        renderHomeVip(c);
    }
  }
  else if(currentMain==='checkin'){
    if(sub==='ƒêi·ªÉm danh tu·∫ßn') {
      renderCheckinWeek(c);
    }
    if(sub==='Bonus tu·∫ßn') {
      renderCheckinBonus(c);
    }
    if(sub==='Nh·∫≠p m√£') { 
      renderRedeem(c);
    }
  }
  else if(currentMain==='quests'){
    if(sub==='Daily') {
      renderQuestDaily(c);
    }
    if(sub==='Weekly') {
      renderQuestWeekly(c);
    }
  }
  else if(currentMain==='game'){
    if(sub==='V√≤ng quay') {
      renderSpin(c);
    }
    if(sub==='H·ªôp qu√†') {
      renderLuckyBox(c);
    }
    if(sub==='Xanh ƒê·ªè') {
      renderBlueRedGame(c);
    }
    if(sub==='XO') {
      renderXO(c);
    }
    if(sub==='Ch·∫µn L·∫ª') {
      renderEvenOdd(c);
    }
  }
  else if(currentMain==='crypto'){ 
    if(sub==='Giao d·ªãch') {
      renderCrypto(c);
    }
    else if(sub==='ƒê√†o Xu') {
      renderCryptoMine(c);
    }
  }
  else if(currentMain==='shop'){
    if(sub==='C·ª≠a h√†ng') {
      renderShop(c);
    }
    if(sub==='Kho ƒë·ªì') {
      renderInventory(c);
    }
  }
  else if(currentMain==='wallet'){
    if(sub==='S·ªë d∆∞') {
      renderWallet(c);
    }
    if(sub==='Giao d·ªãch') {
      renderTx(c);
    }
    if(sub==='L·ªãch s·ª≠ r√∫t') {
      renderWithdrawHistory(c);
    }
    if(sub==='N·∫°p ti·ªÅn') {
      renderDeposit(c);
    }
  }
  else if(currentMain==='community'){
    if(sub==='B·∫°n b√®') {
      renderFriends(c);
    }
  }
  else if(currentMain==='profile'){
    if(sub==='H·ªì s∆°') {
      renderProfile(c);
    }
    if(sub==='BXH') {
      renderLeaderboard(c);
    }
  }
  
  const contactInfo = document.createElement('div');
  contactInfo.className = 'section contact-info';
  contactInfo.innerHTML = `
      <div class="title">üìû Li√™n h·ªá</div>
      <p>H·ªó tr·ª£: https://t.me/nhatpham27 (üí¨Telegram)</p>
      <p>Email: gogolite@support.com</p>
  `;
  c.appendChild(contactInfo);
  
  const activeUsers = document.createElement('div');
  activeUsers.className = 'section active-users';
  activeUsers.innerHTML = `<i class="fa-solid fa-user-group"></i> <span id="activeUserCount">0</span> ng∆∞·ªùi ƒëang ho·∫°t ƒë·ªông`;
  c.appendChild(activeUsers);
  
  let userCount = 35000;
  function updateActiveUsers() {
      const randomChange = Math.floor(Math.random() * 50) - 25;
  userCount += randomChange;
      const activeUserCountEl = $('#activeUserCount');
      if (activeUserCountEl) {
          activeUserCountEl.textContent = fmt(userCount);
  }
  }
  updateActiveUsers(); // Initial update
  setInterval(updateActiveUsers, 5000);
  // Update every 5 seconds
}

// Function to calculate VIP level based on deposit amount
function calculateVipLevel() {
    // S·ª¨A: T·ªïng n·∫°p v·∫´n d·ª±a tr√™n transactions, kh√¥ng thay ƒë·ªïi
    const totalDeposit = transactions
        .filter(tx => tx.reason.includes('N·∫°p ti·ªÅn'))
        .reduce((sum, tx) => sum + Math.abs(tx.amount), 0);
// Define VIP level thresholds
    const vipThresholds = [
        100000, 500000, 1000000, 2000000, 5000000,
        10000000, 20000000, 50000000, 100000000
    ];
  let currentVip = 0;
    let nextVipThreshold = vipThresholds[0];
    let nextVip = 1;
  for (let i = 0; i < vipThresholds.length; i++) {
        if (totalDeposit >= vipThresholds[i]) {
            currentVip = i + 1;
  if (i < vipThresholds.length - 1) {
                nextVip = i + 2;
  nextVipThreshold = vipThresholds[i + 1];
            } else {
                nextVip = 9;
// Already at max VIP
                nextVipThreshold = totalDeposit;
  }
        }
    }

    return { totalDeposit, currentVip, nextVip, nextVipThreshold };
  }


// S·ª¨A: ƒê·ªïi t√™n h√†m c≈© v√† c·∫≠p nh·∫≠t n·ªôi dung
function renderHomeOverview(c){
  // Create a main container for the home content to avoid rendering issues
  const homeContainer = document.createElement('div');
// T·∫°o container cho ph·∫ßn T·ªïng quan v√† Gi·ªõi thi·ªáu ƒë·ªÉ ƒë·∫∑t ch√∫ng c·∫°nh nhau (n·∫øu m√†n h√¨nh ƒë·ªß r·ªông)
  const topSections = document.createElement('div');
  topSections.style.cssText = 'display: grid; grid-template-columns: 1fr; gap: 12px;';
  
  // Ph·∫ßn T·ªïng quan
  const overviewSec = document.createElement('div');
  overviewSec.className='section';
  overviewSec.innerHTML=`
    <div class="title">‚ú® H·ªì s∆° c√° nh√¢n</div>
    <div class="card">
      <div><b>Avatar:</b> <span style="font-size:22px">${user.avatar||'üü°'}</span></div>
      <div class="mt8"><b>T√™n:</b> ${user.name||'Kh√°ch'} &nbsp;
  <span class="muted">Lvl ${level()}</span></div>
      <div class="mt8"><b>EXP:</b> ${fmt(user.exp||0)}</div>
      <div class="mt8"><b>Tu·∫ßn hi·ªán t·∫°i:</b> ${weekKey()}</div>
    </div>
  `;
  topSections.appendChild(overviewSec);
  
  // PH·∫¶N GI·ªöI THI·ªÜU (ƒê∆∞·ª£c ƒë∆∞a v√†o tab T·ªïng quan)
  const introSec = document.createElement('div');
  introSec.className='section';
  introSec.innerHTML=`
    <div class="title">ü§ù Gi·ªõi thi·ªáu b·∫°n b√®</div>
    <div class="card" style="border: 2px solid var(--brand); box-shadow: 0 4px 12px rgba(255, 212, 59, 0.4);">
      <div style="font-weight: 800; font-size: 14px;">M√£ gi·ªõi thi·ªáu c·ªßa b·∫°n:</div>
      <div class="mt8 center" style="font-size: 20px; font-weight: 900; color: var(--brand);">USER${user.name.toUpperCase().slice(0, 5)}</div>
      <div class="muted mt8 center" style="font-size: 12px;">Chia s·∫ª m√£ n√†y ƒë·ªÉ nh·∫≠n 10% th∆∞·ªüng t·ª´ b·∫°n b√®!</div>
      <button class="btn mt10" style="width:100%; background: var(--brand); color: #212529;">Sao ch√©p & M·ªùi ngay</button>
    </div>
  `;
  topSections.appendChild(introSec);

  // Th√™m c√°c ph·∫ßn ƒë·∫ßu ti√™n v√†o homeContainer
  homeContainer.appendChild(topSections);
// VIP Section
  const { totalDeposit, currentVip, nextVip, nextVipThreshold } = calculateVipLevel();
  const vipSec = document.createElement('div');
  vipSec.className = 'section';
  vipSec.innerHTML = `<div class="title">‚≠ê C·∫•p VIP</div>`;
  const vipCard = document.createElement('div');
  vipCard.className = 'card';
  if (currentVip === 9) {
    vipCard.innerHTML = `
      <div class="center">
        <div style="font-size: 24px; font-weight: bold;">VIP 9</div>
        <div class="muted">B·∫°n ƒë√£ ƒë·∫°t c·∫•p VIP cao nh·∫•t!</div>
        <div class="mt8">T·ªïng n·∫°p: ${fmt(totalDeposit)} VNƒê</div>
      </div>
    `;
  } else {
    const progress = (totalDeposit / nextVipThreshold) * 100;
  vipCard.innerHTML = `
      <div class="row">
        <div>C·∫•p VIP hi·ªán t·∫°i: <b>VIP ${currentVip}</b></div>
        <div style="font-size: 14px;">Next: <b>VIP ${nextVip}</b></div>
      </div>
      <div class="progress mt8"><div style="width:${Math.min(progress, 100)}%"></div></div>
      <div class="muted mt8">${fmt(totalDeposit)} / ${fmt(nextVipThreshold)} VNƒê (T·ªïng n·∫°p)</div>
    `;
  }
  vipSec.appendChild(vipCard);
  homeContainer.appendChild(vipSec);

  const bankSec = document.createElement('div');
  bankSec.className = 'section';
  bankSec.innerHTML = `<div class="title">üè¶ V√≠ & Ng√¢n h√†ng</div>`;
  const card = document.createElement('div');
  card.className = 'card';
  if (linkedBank) {
    card.innerHTML = `
      <div class="row"><div><b>${linkedBank.logo} ${linkedBank.name}</b></div>
      <button class="btn secondary" id="chgBank">ƒê·ªïi</button></div>
      <div class="big mt8">${fmt(balance)} VNƒê</div>`;
  } else {
    card.innerHTML = `
      <div class="muted">Ch∆∞a li√™n k·∫øt ng√¢n h√†ng</div>
      <button class="btn mt10" id="lnkBank">Li√™n k·∫øt ngay</button>`;
  }
  bankSec.appendChild(card);
  homeContainer.appendChild(bankSec);

  const btn = card.querySelector('#lnkBank') || card.querySelector('#chgBank');
  if (btn) btn.onclick = showBankLink;
  const { videos, checkins, vPct, cPct } = weeklyProgress();

  const stats = document.createElement('div');
  stats.className = 'section';
  stats.innerHTML = `<div class="title">üìä Th·ªëng k√™ nhanh</div>
    <div class="stats-grid">
      <div class="stat">
        <div>üé¨ Video tu·∫ßn</div>
        <div class="big">${videos}/10</div>
        <div class="progress mt8"><div style="width:${vPct}%"></div></div>
 
      </div>
      <div class="stat">
        <div>üìÖ ƒêi·ªÉm danh</div>
        <div class="big">${checkins}/7</div>
        <div class="progress mt8"><div 
  style="width:${cPct}%"></div></div>
 
     
  </div>
    </div>
    <div class="row mt10">
      <button class="btn" id="gotoDaily">‚ö°Ô∏è L√†m nhi·ªám v·ª•</button>
      <button class="btn secondary" id="gotoCheckin">üóìÔ∏è ƒêi·ªÉm danh</button>
      <button class="btn secondary" id="gotoShop">üõçÔ∏è Shop</button>
    </div>`;
  homeContainer.appendChild(stats);
  stats.querySelector('#gotoDaily').onclick = () => { currentMain = 'quests'; currentSubIndex = 0; renderSubTabs(); renderContent(); };
  stats.querySelector('#gotoCheckin').onclick = () => { currentMain = 'checkin'; currentSubIndex = 0; renderSubTabs(); renderContent(); };
  stats.querySelector('#gotoShop').onclick = () => { currentMain = 'shop'; currentSubIndex = 0; renderSubTabs(); renderContent(); };

  const news = document.createElement('div');
  news.className = 'section';
  news.innerHTML = `<div class="title">üì∞ B·∫£ng tin</div>
    <div class="card"><b>üî• S·ª± ki·ªán tu·∫ßn:</b> Ho√†n th√†nh 10 video + 7 ng√†y ƒëi·ªÉm danh ‚Üí Th∆∞·ªüng <b>300,000 VNƒê</b>.</div>
    <div class="card mt8"><b>üéÅ M√£ th∆∞·ªüng:</b> D√πng <code>EVENT2025</code> ƒë·ªÉ nh·∫≠n <b>25,000 VNƒê</b>.</div>`;
  homeContainer.appendChild(news);

  const sponsors = document.createElement('div');
  sponsors.className = 'section';
  sponsors.innerHTML = `
    <div class="title">üèÜ ƒê·ªëi t√°c chi·∫øn l∆∞·ª£c</div>
    <div class="sponsor-logos">
      <div class="sponsor-icon">üè¶</div>
      <div class="sponsor-icon">üí≥</div>
      <div class="sponsor-icon">üí∞</div>
      <div class="sponsor-icon">üåê</div>
    </div>`;
  homeContainer.appendChild(sponsors);

  c.appendChild(homeContainer);
}

// M·ªöI: H√†m render cho tab L∆∞u √Ω
function renderHomeNotes(c) {
    const sec = document.createElement('div');
  sec.className = 'section';
    sec.innerHTML = `<div class="title">‚ö†Ô∏è C√°c L∆∞u √Ω quan tr·ªçng</div>`;

    const generalNotes = document.createElement('div');
    generalNotes.className = 'card mt8';
  generalNotes.innerHTML = `
        <div style="font-weight: bold; color: var(--brand);">Quy t·∫Øc chung</div>
        <ul>
            <li>**Kh√¥ng s·ª≠ d·ª•ng ph·∫ßn m·ªÅm gi·∫£ l·∫≠p** (Emulator) ho·∫∑c VPN ƒë·ªÉ gian l·∫≠n.
  H·ªá th·ªëng s·∫Ω kh√≥a t√†i kho·∫£n vƒ©nh vi·ªÖn.</li>
            <li>M·ªçi giao d·ªãch **N·∫°p/R√∫t** c·∫ßn ƒë∆∞·ª£c th·ª±c hi·ªán qua Ng√¢n h√†ng ƒë√£ li√™n k·∫øt ch√≠nh ch·ªß.</li>
            <li>H·∫°n m·ª©c r√∫t ti·ªÅn t·ªëi thi·ªÉu l√† **250,000 VNƒê**.</li>
            <li>N·∫øu c√≥ b·∫•t k·ª≥ l·ªói n√†o, vui l√≤ng li√™n h·ªá **GGL Chatbot** ho·∫∑c Zalo H·ªó tr·ª£.</li>
        </ul>
    `;
  sec.appendChild(generalNotes);
    
    const taskNotes = document.createElement('div');
    taskNotes.className = 'card mt10';
    taskNotes.innerHTML = `
        <div style="font-weight: bold; color: var(--info);">L∆∞u √Ω v·ªÅ Nhi·ªám v·ª• & ƒêi·ªÉm danh</div>
        <ul>
            <li>**Nhi·ªám v·ª• h√†ng ng√†y** s·∫Ω ƒë∆∞·ª£c reset v√†o 00:00 (gi·ªù Vi·ªát Nam).</li>
            <li>Th∆∞·ªüng **ƒêi·ªÉm danh tu·∫ßn** (Bonus tu·∫ßn) ch·ªâ c√≥ th·ªÉ nh·∫≠n m·ªôt l·∫ßn sau khi ho√†n th√†nh 7 ng√†y ƒëi·ªÉm danh li√™n ti·∫øp.</li>
      
      <li>EXP nh·∫≠n ƒë∆∞·ª£c s·∫Ω gi√∫p b·∫°n **tƒÉng c·∫•p VIP**, tƒÉng kh·∫£ nƒÉng nh·∫≠n th∆∞·ªüng v√† n√¢ng cao h·∫°n m·ª©c giao d·ªãch.</li>
        </ul>
    `;
  sec.appendChild(taskNotes);
    
    const depositNotes = document.createElement('div');
    depositNotes.className = 'card mt10';
    depositNotes.innerHTML = `
        <div style="font-weight: bold; color: var(--success);">L∆∞u √Ω khi N·∫°p ti·ªÅn</div>
        <ul>
            <li>Lu√¥n ki·ªÉm tra l·∫°i **N·ªôi dung chuy·ªÉn kho·∫£n** v√† **S·ªë ti·ªÅn ch√≠nh x√°c** tr∆∞·ªõc khi chuy·ªÉn.</li>
            <li>H·ªá th·ªëng x·ª≠ l√Ω giao d·ªãch t·ª± ƒë·ªông.
  N·∫øu qu√° **15 ph√∫t** kh√¥ng th·∫•y ti·ªÅn c·ªông, vui l√≤ng g·ª≠i bill chuy·ªÉn kho·∫£n cho b·ªô ph·∫≠n h·ªó tr·ª£.</li>
        </ul>
    `;
  sec.appendChild(depositNotes);

    c.appendChild(sec);
}
// M·ªöI: H√†m render cho tab C·∫•p VIP
function renderHomeVip(c) {
    const sec = document.createElement('div');
  sec.className = 'section';
    sec.innerHTML = `<div class="title">üåü C·∫•p VIP & ∆Øu ƒë√£i</div>`;
  const { totalDeposit, currentVip, nextVip, nextVipThreshold } = calculateVipLevel();
    const isMaxVip = currentVip === 9;
    
    const currentVipCard = document.createElement('div');
  currentVipCard.className = 'card';
    if (isMaxVip) {
        currentVipCard.innerHTML = `
            <div class="center">
                <div style="font-size: 28px; font-weight: 900; color: var(--brand);">VIP 9 MAX</div>
                <div class="muted mt8">B·∫°n ƒë√£ ƒë·∫°t c·∫•p VIP cao nh·∫•t!
  Ti·∫øp t·ª•c duy tr√¨ ho·∫°t ƒë·ªông ƒë·ªÉ nh·∫≠n ∆∞u ƒë√£i ƒë·∫∑c bi·ªát.</div>
                <div class="mt8">T·ªïng n·∫°p: **${fmt(totalDeposit)} VNƒê**</div>
            </div>
        `;
  } else {
        const progress = (totalDeposit / nextVipThreshold) * 100;
  currentVipCard.innerHTML = `
            <div class="row">
                <div>C·∫•p VIP hi·ªán t·∫°i: <b>VIP ${currentVip}</b></div>
                <div style="font-size: 14px;">Next: <b>VIP ${nextVip}</b></div>
            </div>
            <div class="progress mt8"><div style="width:${Math.min(progress, 100)}%"></div></div>
            <div class="muted mt8">${fmt(totalDeposit)} / ${fmt(nextVipThreshold)} VNƒê (T·ªïng n·∫°p)</div>
            <div class="mt8 center">C·∫ßn n·∫°p th√™m **${fmt(nextVipThreshold - totalDeposit)} VNƒê** ƒë·ªÉ l√™n VIP ${nextVip}</div>
            <button class="btn mt10" style="width:100%; background: var(--success);"
  onclick="
                currentMain = 'wallet'; 
                currentSubIndex = MAIN['wallet'].subtabs.indexOf('N·∫°p ti·ªÅn'); 
                renderSubTabs(); 
                renderContent();
            ">üíµ N·∫°p ti·ªÅn ƒë·ªÉ n√¢ng c·∫•p</button>
        `;
  }
    sec.appendChild(currentVipCard);

    // B·∫£ng chi ti·∫øt c·∫•p VIP
    const vipTableCard = document.createElement('div');
  vipTableCard.className = 'card mt10';
    vipTableCard.innerHTML = `
        <div class="title">B·∫£ng C·∫•p VIP & ƒêi·ªÅu ki·ªán</div>
        <table class="table">
            <thead>
                <tr>
                    <th>VIP</th>
                    <th>T·ªïng N·∫°p T·ªëi 
  Thi·ªÉu</th>
                    <th>∆Øu ƒë√£i (Th∆∞·ªüng ƒêi·ªÉm Danh)</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>VIP 0</td><td>0 VNƒê</td><td>${fmt(5000)} VNƒê</td></tr>
                <tr><td>VIP 
  1</td><td>${fmt(100000)} VNƒê</td><td>${fmt(10000)} VNƒê</td></tr>
                <tr><td>VIP 2</td><td>${fmt(500000)} VNƒê</td><td>${fmt(15000)} VNƒê</td></tr>
                <tr><td>VIP 3</td><td>${fmt(1000000)} VNƒê</td><td>${fmt(20000)} VNƒê</td></tr>
                <tr><td>VIP 4</td><td>${fmt(2000000)} VNƒê</td><td>${fmt(25000)} VNƒê</td></tr>
                <tr><td>VIP 5</td><td>${fmt(5000000)} VNƒê</td><td>${fmt(30000)} VNƒê</td></tr>
                <tr><td>VIP 6</td><td>${fmt(10000000)} VNƒê</td><td>${fmt(35000)} VNƒê</td></tr>
   
              <tr><td>VIP 7</td><td>${fmt(20000000)} VNƒê</td><td>${fmt(45000)} VNƒê</td></tr>
                <tr><td>VIP 8</td><td>${fmt(50000000)} VNƒê</td><td>${fmt(55000)} VNƒê</td></tr>
                <tr><td>VIP 9</td><td>${fmt(100000000)} VNƒê</td><td>${fmt(55000)} VNƒê</td></tr>
            </tbody>
        </table>
        <p class="muted mt8" style="font-size: 11px;">*C·∫•p VIP quy·∫øt ƒë·ªãnh **Th∆∞·ªüng ƒêi·ªÉm danh h√†ng ng√†y** v√† **H·∫°n m·ª©c giao d·ªãch**.</p>
 
    `;
    sec.appendChild(vipTableCard);

    c.appendChild(sec);
}


// H√†m m·ªõi ƒë·ªÉ t√≠nh th∆∞·ªüng ƒëi·ªÉm danh d·ª±a tr√™n c·∫•p VIP
function getDailyCheckinReward() {
    const { currentVip } = calculateVipLevel();
// L·∫•y m·ª©c th∆∞·ªüng m·ªõi
    const rewards = [5000, 10000, 15000, 20000, 25000, 30000, 35000, 45000, 55000, 55000];
  return rewards[Math.min(currentVip, rewards.length - 1)];
}

// FIX: C·∫≠p nh·∫≠t h√†m renderCheckinWeek
function renderCheckinWeek(c){
    ensureCheckinWeek();
    const weekDays=['T2','T3','T4','T5','T6','T7','CN'];
  const dailyReward = getDailyCheckinReward();
    const sec=document.createElement('div'); sec.className='section';
    sec.innerHTML = `<div class="title">üìÖ ƒêi·ªÉm danh theo tu·∫ßn (+${fmt(dailyReward)}/ng√†y)</div>`;
    const grid=document.createElement('div');
    grid.className='week-grid mt10';
// Check if the daily check-in has been done
    const dailyCheckinDone = localStorage.getItem('dailyCheckin') === todayKey();
  for(let i=1;i<=7;i++){
        const d=document.createElement('div');
        const today = new Date().getDay() + 1;
// 1=T2, 7=CN
        const isToday = (i === today);
        const isChecked = checkin.days.includes(i);
  d.className = 'day' + (isChecked ? ' checked' : '') + (isToday ? ' active-day' : '');
  d.innerHTML = `<i class="fa-solid fa-sack-dollar"></i><small>${weekDays[(i-1)%7]}</small>`;
        
        d.onclick = () => {
            if (!isToday) {
                showToast("Th√¥ng b√°o", "B·∫°n ch·ªâ c√≥ th·ªÉ ƒëi·ªÉm danh cho ng√†y h√¥m nay.", "info");
  return;
            }
            if (dailyCheckinDone) {
                showToast("Th√¥ng b√°o", "B·∫°n ƒë√£ ƒëi·ªÉm danh cho ng√†y h√¥m nay r·ªìi. Quay l·∫°i v√†o ng√†y mai nh√©.", "info");
  return;
            }
            // S·ª¨A: Ti·ªÅn ƒêi·ªÉm danh l√† ti·ªÅn ƒê√ìNG BƒÇNG (m·∫∑c ƒë·ªãnh)
            if(updateBalance(dailyReward, `ƒêi·ªÉm danh ng√†y ${i}`)) { 
                checkin.days.push(i);
  save(LS.checkin, checkin);
                localStorage.setItem('dailyCheckin', todayKey()); // Mark today as checked
                addExp(50);
  const q = ensureQuestToday();
                q.checkinToday = true;
                save(LS.quests, quests);
                renderContent();
            }
        };
        grid.appendChild(d);
  }
    sec.appendChild(grid);

    const noteCard = document.createElement('div');
    noteCard.className = 'card mt10';
  noteCard.innerHTML = `
        <div style="font-weight: bold;">L∆∞u √Ω khi ƒëi·ªÉm danh:</div>
        <ul>
            <li>N√™n ƒëi·ªÉm danh v√†o **bu·ªïi s√°ng s·ªõm** ƒë·ªÉ nh·∫≠n ƒë∆∞·ª£c may m·∫Øn.</li>
            <li>**Tuy·ªát ƒë·ªëi kh√¥ng** s·ª≠ d·ª•ng ph·∫ßn m·ªÅm gi·∫£ l·∫≠p (Emulator), hack ho·∫∑c cheat.</li>
            <li>Ch·ªâ ƒëi·ªÉm danh **m·ªôt l·∫ßn duy nh·∫•t** trong ng√†y.</li>
        </ul>`;
  sec.appendChild(noteCard);

    const scheduleCard = document.createElement('div');
    scheduleCard.className = 'card mt10';
    scheduleCard.innerHTML = `
        <div style="font-weight: bold;">L·ªãch tr√¨nh h√¥m nay:</div>
        <ul>
            <li>**08:00 - 10:00:** ƒêi·ªÉm danh ƒë·ªÉ nh·∫≠n th√™m 20 EXP.</li>
            <li>**12:00 - 14:00:** Ho√†n th√†nh nhi·ªám v·ª• video ƒë·ªÉ nh·∫≠n th√™m 10 EXP.</li>
            <li>**18:00 - 20:00:** Tham gia mini game V√≤ng quay may m·∫Øn.</li>
 
  
  
        </ul>`;
    sec.appendChild(scheduleCard);

    c.appendChild(sec);
}


function renderCheckinBonus(c){
  ensureCheckinWeek();
  const done7 = checkin.days && checkin.days.length >= 7;
  const already = (checkin.bonusClaimedWeeks || []).includes(checkin.weekKey);
  const sec = document.createElement('div');
  sec.className = 'section';
  sec.innerHTML = `<div class="title">üéÅ Th∆∞·ªüng tu·∫ßn (+200,000 VNƒê)</div>`;

  const card = document.createElement('div');
  card.className = 'card mt8';
  if (done7) {
    card.innerHTML = `<div class="center" style="font-weight: bold;">B·∫°n ƒë√£ ƒë·ªß ƒëi·ªÅu ki·ªán nh·∫≠n th∆∞·ªüng tu·∫ßn!</div>`;
  } else {
    card.innerHTML = `<div class="center muted">Ho√†n th√†nh ƒë·ªß 7 ng√†y ƒëi·ªÉm danh trong tu·∫ßn ƒë·ªÉ nh·∫≠n th∆∞·ªüng.</div>`;
  }

  const btn = document.createElement('button');
  btn.className = 'btn mt10';
  btn.style.width = '100%';
  btn.textContent = 'Nh·∫≠n Bonus +200,000 VNƒê';
  btn.disabled = !done7 || already;
  
  btn.onclick = () => {
    if(done7 && !already){
      checkin.bonusClaimedWeeks.push(checkin.weekKey);
  save(LS.checkin, checkin);
      // S·ª¨A: Ti·ªÅn Bonus l√† ti·ªÅn ƒê√ìNG BƒÇNG (m·∫∑c ƒë·ªãnh)
      if(updateBalance(200000,'Bonus tu·∫ßn')){ 
        addExp(120); 
        renderContent();
  }
    }
  };

  sec.appendChild(card);
  sec.appendChild(btn); 
  c.appendChild(sec);
}

function ensureQuestToday(){
  const key=todayKey();
  if(!quests[key]) quests[key]={
    video:0,
    claimVideo:false,
    share:false,
    claimShare:false,
    invite:false,
    claimInvite:false,
    checkinToday: false,
    spinToday: false
  };
  return quests[key];
}

function renderQuestDaily(c){
  const q=ensureQuestToday();
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML=`<div class="title">üìù Nhi·ªám v·ª• ng√†y</div>`;

  const notesCard = document.createElement('div');
  notesCard.className = 'card mt8';
  notesCard.innerHTML = `
      <div style="font-weight: bold;">L∆∞u √Ω khi l√†m nhi·ªám v·ª•:</div>
      <ul>
          <li>M·ªói nhi·ªám v·ª• ch·ªâ c√≥ th·ªÉ l√†m **m·ªôt l·∫ßn duy nh·∫•t** m·ªói ng√†y.</li>
          <li>B·∫°n ph·∫£i ho√†n th√†nh nhi·ªám v·ª• ƒë·ªÉ c√≥ th·ªÉ nh·∫≠n th∆∞·ªüng.</li>
          <li>Th∆∞·ªüng s·∫Ω ƒë∆∞·ª£c c·ªông th·∫≥ng v√†o s·ªë d∆∞ c·ªßa b·∫°n.</li>
          <li>Th∆∞·ªüng nhi·ªám v·ª• l√† ti·ªÅn **ƒê√≥ng bƒÉng**.</li>
      </ul>
  `;
  sec.appendChild(notesCard);

  // Quest 1: Xem video - ƒê√É S·ª¨A
  const videoLink = 'https://www.tiktok.com/@chunhatpham?_t=ZS-90ZRBjffwgB&_r=1';
  const card1=document.createElement('div'); 
  card1.className='card mt10';
  card1.innerHTML=`
    <div class="row">
        <div><b>Xem video:</b> ${q.video}/3</div>
        <button class="action-btn-quest" id="doVideo">${q.video < 3 ?
  'L√†m' : 'Ho√†n th√†nh'}</button>
    </div>`;
  
  const btn1=card1.querySelector('#doVideo');
  btn1.disabled = q.claimVideo;
// Logic cho n√∫t "L√†m"
  btn1.onclick=()=>{
    if(q.video >= 3 && !q.claimVideo) {
      // S·ª¨A: Ti·ªÅn nhi·ªám v·ª• l√† ti·ªÅn ƒê√ìNG BƒÇNG (m·∫∑c ƒë·ªãnh)
      if(updateBalance(50000, 'Ho√†n th√†nh nhi·ªám v·ª• video')) {
        q.claimVideo=true;
  addExp(40); save(LS.quests,quests); renderContent();
      }
      return;
  }
    
    // M·ªöI: Hi·ªÉn th·ªã th√¥ng b√°o v·ªõi link k√™nh v√† n√∫t ho√†n th√†nh ngay
    const tempOverlay = document.createElement('div');
  tempOverlay.className = 'overlay';
    const box=document.createElement('div'); 
    box.className='modal';
    box.innerHTML = `
        <div style="font-size:30px; margin-bottom:10px;">üé¨ Xem Video</div>
        <p class="muted">Sao ch√©p link k√™nh v√† xem video ƒë·ªÉ ho√†n th√†nh nhi·ªám v·ª•.
  B·∫•m Ho√†n th√†nh sau khi xem.</p>
        <div class="card" style="background: rgba(255,255,255,.1); padding: 8px; font-size: 14px; margin-top: 10px;">
            <i class="fa-brands fa-tiktok"></i> 
            <a href="${videoLink}" target="_blank" style="color: var(--text); text-decoration: none; word-break: break-all;">${videoLink}</a>
        </div>
        <button class="btn mt10" id="completeVideoTask" style="width:100%; background: var(--success);">‚úÖ Ho√†n th√†nh (Xem ${q.video + 1}/3)</button>
    `;
  box.querySelector('#completeVideoTask').onclick = () => {
        // TƒÉng s·ªë l∆∞·ª£ng video ƒë√£ xem
        q.video = Math.min(q.video + 1, 3);
  save(LS.quests, quests);
        tempOverlay.remove();
        showToast('Th√†nh c√¥ng', `B·∫°n ƒë√£ xem ${q.video}/3 video.`, 'info');
        renderContent();
    };
  box.querySelector('#completeVideoTask').textContent = `‚úÖ Ho√†n th√†nh (Xem ${q.video < 3 ? q.video + 1 : q.video}/3)`;


    tempOverlay.appendChild(box); 
    document.body.appendChild(tempOverlay);
  };
// END S·ª¨A LOGIC

  sec.appendChild(card1);

  // Quest 2: Chia s·∫ª ·ª©ng d·ª•ng - ƒê√É S·ª¨A
  const shareLink = 'https://changdinhanh-cyber.github.io/gogolite.com/';
  const card2=document.createElement('div'); card2.className='card mt10';
  card2.innerHTML = `
    <div class="row">
        <div><b>Chia s·∫ª ·ª©ng d·ª•ng:</b> ${q.share ?
  'Ho√†n th√†nh' : 'Ch∆∞a'}</div>
        <button class="action-btn-quest" id="doShare">L√†m</button>
    </div>`;
  const btn2 = card2.querySelector('#doShare');
  btn2.disabled = q.claimShare;
  btn2.onclick = () => {
    if (q.claimShare) return;
// M·ªöI: Hi·ªÉn th·ªã modal chia s·∫ª
    const shareOverlay = document.createElement('div');
    shareOverlay.className = 'overlay';
  const shareBox = document.createElement('div');
    shareBox.className = 'modal';

    shareBox.innerHTML = `
        <div class="row">
            <h3 style="margin:0; flex:1">üì§ Chia s·∫ª ·ª©ng d·ª•ng</h3>
            <button type="button" class="btn secondary" id="closeShare">ƒê√≥ng</button>
        </div>
        <p class="muted mt10">Sao ch√©p ho·∫∑c chia s·∫ª link ·ª©ng d·ª•ng ƒë·∫øn b·∫°n b√® ƒë·ªÉ nh·∫≠n th∆∞·ªüng 10,000 VNƒê.</p>
        <div class="card" style="background: rgba(255,255,255,.1); padding: 8px; font-size: 
  14px; margin-top: 10px; word-break: break-all; text-align: center;">
            <i class="fa-solid fa-link"></i> **${shareLink}**
        </div>
        <div class="row mt10" style="justify-content: space-around; flex-wrap: wrap;">
            <button class="btn" style="background: #4dabf7; color: white;"
  onclick="window.open('https://facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareLink)}', '_blank');">FB</button>
            <button class="btn" style="background: #28a745; color: white;"
  onclick="window.open('https://zalo.me/share/link?url=${encodeURIComponent(shareLink)}', '_blank');">Zalo</button>
            <button class="btn" style="background: var(--brand); color: #212529;"
  onclick="navigator.clipboard.writeText('${shareLink}'); showToast('ƒê√£ sao ch√©p','Link ƒë√£ ƒë∆∞·ª£c sao ch√©p','info');">Copy</button>
        </div>
        <button class="btn mt10" id="completeShareTask" style="width:100%; background: var(--success);">‚úÖ Ho√†n th√†nh Chia s·∫ª</button>
    `;
  shareBox.querySelector('#closeShare').onclick = () => shareOverlay.remove();
    
    shareBox.querySelector('#completeShareTask').onclick = () => {
        // S·ª¨A: Ti·ªÅn nhi·ªám v·ª• l√† ti·ªÅn ƒê√ìNG BƒÇNG (m·∫∑c ƒë·ªãnh)
        if (updateBalance(10000, 'Chia s·∫ª ·ª©ng d·ª•ng')) {
            q.share = true;
  q.claimShare = true;
            addExp(20);
            save(LS.quests, quests);
            shareOverlay.remove();
            renderContent();
        }
    };
    
    shareOverlay.appendChild(shareBox);
    document.body.appendChild(shareOverlay);
  };
  sec.appendChild(card2);
// Quest 3: M·ªùi b·∫°n b√®
  const card3=document.createElement('div'); card3.className='card mt10';
  card3.innerHTML = `
    <div class="row">
        <div><b>M·ªùi b·∫°n b√®:</b> ${q.invite ?
  'Ho√†n th√†nh' : 'Ch∆∞a'}</div>
        <button class="action-btn-quest" id="doInvite">L√†m</button>
    </div>`;
  const btn3 = card3.querySelector('#doInvite');
  btn3.disabled = q.claimInvite;
  btn3.onclick = () => {
    if(!q.claimInvite){
      // S·ª¨A: Ti·ªÅn nhi·ªám v·ª• l√† ti·ªÅn ƒê√ìNG BƒÇNG (m·∫∑c ƒë·ªãnh)
      if(updateBalance(10000, 'M·ªùi b·∫°n b√®')){
        q.invite = true;
  q.claimInvite = true;
        addExp(25);
        save(LS.quests, quests);
        showToast("Th√†nh c√¥ng", "B·∫°n ƒë√£ m·ªùi b·∫°n b√®. +10,000 VNƒê", "success");
// Simulated referral link pop-up
        window.open('https://gogo.vn/referral?id=user12345', '_blank');
        renderContent();
  }
    }
  };
  sec.appendChild(card3);
  // New quest: Daily Check-in
  const card4 = document.createElement('div');
  card4.className = 'card mt10';
  card4.innerHTML = `
    <div class="row">
        <div><b>ƒêi·ªÉm danh h√†ng ng√†y:</b> ${q.checkinToday ?
  'Ho√†n th√†nh' : 'Ch∆∞a'}</div>
        <button class="action-btn-quest" id="doCheckinDaily">L√†m</button>
    </div>
  `;
  const btn4 = card4.querySelector('#doCheckinDaily');
  btn4.disabled = q.checkinToday;
  btn4.onclick = () => {
    if (q.checkinToday) {
        showToast("Th√¥ng b√°o", "B·∫°n ƒë√£ ho√†n th√†nh nhi·ªám v·ª• n√†y r·ªìi.", "info");
  return;
    }
    const today = new Date().getDay() + 1;
    ensureCheckinWeek();
  if (checkin.days.includes(today)) {
        // S·ª¨A: Ti·ªÅn nhi·ªám v·ª• l√† ti·ªÅn ƒê√ìNG BƒÇNG (m·∫∑c ƒë·ªãnh)
        if (updateBalance(20000, "Ho√†n th√†nh nhi·ªám v·ª• ƒëi·ªÉm danh")) {
            q.checkinToday = true;
  addExp(15);
            save(LS.quests, quests);
            renderContent();
        }
    } else {
        showToast("H∆∞·ªõng d·∫´n", "H√£y ƒë·∫øn m·ª•c 'ƒêi·ªÉm danh' ƒë·ªÉ ho√†n th√†nh nhi·ªám v·ª•.", "info");
  }
  };
  sec.appendChild(card4);

  // New quest: Spin the Wheel
  const card5 = document.createElement('div');
  card5.className = 'card mt10';
  card5.innerHTML = `
    <div class="row">
        <div><b>Quay V√≤ng quay may m·∫Øn:</b> ${q.spinToday ?
  'Ho√†n th√†nh' : 'Ch∆∞a'}</div>
        <button class="action-btn-quest" id="doSpin">L√†m</button>
    </div>
  `;
  const btn5 = card5.querySelector('#doSpin');
  btn5.disabled = q.spinToday;
  btn5.onclick = () => {
    if (q.spinToday) {
        showToast("Th√¥ng b√°o", "B·∫°n ƒë√£ ho√†n th√†nh nhi·ªám v·ª• n√†y r·ªìi.", "info");
  return;
    }
    showToast("H∆∞·ªõng d·∫´n", "H√£y ƒë·∫øn m·ª•c Mini game > V√≤ng quay ƒë·ªÉ ho√†n th√†nh nhi·ªám v·ª•.", "info");
  };
  sec.appendChild(card5);
  
  c.appendChild(sec);
}
function renderQuestWeekly(c){
  ensureQuestToday();
  let vid=0; Object.values(quests).forEach(q=> vid += (q.video||0));
  const sec=document.createElement('div'); sec.className='section';
  const canClaim = (vid>=10) && (checkin.days && checkin.days.length>=7);
  sec.innerHTML = `
    <div class="title">üì¶ Nhi·ªám v·ª• tu·∫ßn (Th∆∞·ªüng l·ªõn)</div>
    <div class="card">üé¨ Video: ${Math.min(vid,10)}/10
      <div class="progress mt8"><div style="width:${vPct}%"></div></div>
    </div>
    <div class="card mt8">üìÖ ƒêi·ªÉm danh: ${checkin.days?checkin.days.length:0}/7
      <div class="progress mt8"><div style="width:${cPct}%"></div></div>
    </div>
  `;
  const btn=document.createElement('button'); btn.className='btn mt10'; btn.style.width='100%'; btn.textContent='Nh·∫≠n +300,000 VNƒê';
  btn.disabled = !canClaim;
  btn.onclick=()=>{
    if(!canClaim) return;
  // S·ª¨A: Ti·ªÅn nhi·ªám v·ª• l√† ti·ªÅn ƒê√ìNG BƒÇNG (m·∫∑c ƒë·ªãnh)
  updateBalance(300000,'Th∆∞·ªüng nhi·ªám v·ª• tu·∫ßn'); addExp(200); showToast('Ch√∫c m·ª´ng','B·∫°n ƒë√£ nh·∫≠n 300,000 VNƒê','success');
    btn.disabled=true;
  };
  sec.appendChild(btn);
  c.appendChild(sec);
}

function renderSpin(c){
  const cost = 100000; 
  const sec=document.createElement('div');
  sec.className='section';
  sec.innerHTML = `<div class="title">üé∞ V√≤ng quay may m·∫Øn</div>
      <div class="card center">M·ªói l∆∞·ª£t quay t·ªën ${fmt(cost)} VNƒê</div>`;
// S·ª¨A: C·∫≠p nh·∫≠t hi·ªÉn th·ªã chi ph√≠
  const wheel = document.createElement('div'); wheel.className='spin-wheel';
  const pointer = document.createElement('div'); pointer.className='spin-pointer';
  wheel.appendChild(pointer);
  sec.appendChild(wheel);

  const btn = document.createElement('button'); btn.className='btn'; btn.style.width='100%'; btn.textContent='Quay ngay';
  btn.onclick = ()=>{
    if (balance < cost) {
      showToast('Kh√¥ng ƒë·ªß s·ªë d∆∞', 'B·∫°n c·∫ßn c√≥ √≠t nh·∫•t 100,000 VNƒê ƒë·ªÉ quay.', 'error');
// S·ª¨A: C·∫≠p nh·∫≠t th√¥ng b√°o
      return;
  }
    // S·ª¨A: Tr·ª´ ti·ªÅn c∆∞·ª£c (m·∫∑c ƒë·ªãnh: ∆∞u ti√™n Kh·∫£ d·ª•ng tr∆∞·ªõc)
    if (!updateBalance(-cost, 'Ph√≠ v√≤ng quay')) {
      showToast('L·ªói', 'Kh√¥ng th·ªÉ tr·ª´ ti·ªÅn t·ª´ s·ªë d∆∞.', 'error');
  return;
    }

    btn.disabled = true;
    const deg = 720 + Math.floor(Math.random()*360);
    wheel.style.transition='transform 3s cubic-bezier(.2,.8,.2,1)';
    wheel.style.transform=`rotate(${deg}deg)`;
  setTimeout(()=>{
      btn.disabled=false;
      const prize=["+20,000 VNƒê","+50 EXP","+10,000 VNƒê","H·ª•t r·ªìi","+30,000 VNƒê","+80 EXP"];
      const idx=Math.floor(((deg%360)/60));
      const reward=prize[(6-idx)%6];
      if(reward.includes("VNƒê")) {
        const val = parseInt(reward.replace(/\D/g,''));
        // S·ª¨A: Ti·ªÅn th·∫Øng game l√† ti·ªÅn KH·∫¢ D·ª§NG
        updateBalance(val,"V√≤ng quay", 'available');
      } else if(reward.includes("EXP")) {
        addExp(parseInt(reward.replace(/\D/g,'')));
      }
      showToast("K·∫øt qu·∫£", reward, 'success');
      const q = ensureQuestToday();
      q.spinToday = true;
      save(LS.quests, quests);
      renderContent();
    },3100);
  };
  sec.appendChild(btn);
  c.appendChild(sec);
}

function renderLuckyBox(c){
  const cost = 100000; 
  const sec=document.createElement('div');
  sec.className='section';
  sec.innerHTML = `<div class="title">üéÅ H·ªôp qu√† b√≠ ·∫©n</div>
    <div class="card center">M·ªói l·∫ßn m·ªü t·ªën ${fmt(cost)} VNƒê ‚Äî ph·∫ßn th∆∞·ªüng ng·∫´u nhi√™n.</div>`;
// S·ª¨A: C·∫≠p nh·∫≠t hi·ªÉn th·ªã chi ph√≠
  const btn=document.createElement('button'); btn.className='btn'; btn.style.width='100%'; btn.textContent='M·ªü h·ªôp';
  btn.onclick=()=>{
    if (balance < cost) {
      showToast('Kh√¥ng ƒë·ªß s·ªë d∆∞', 'B·∫°n c·∫ßn c√≥ √≠t nh·∫•t 100,000 VNƒê ƒë·ªÉ m·ªü h·ªôp.', 'error');
// S·ª¨A: C·∫≠p nh·∫≠t th√¥ng b√°o
      return;
  }
    // S·ª¨A: Tr·ª´ ti·ªÅn c∆∞·ª£c (m·∫∑c ƒë·ªãnh: ∆∞u ti√™n Kh·∫£ d·ª•ng tr∆∞·ªõc)
    if (!updateBalance(-cost, 'Ph√≠ m·ªü h·ªôp qu√†')) {
      showToast('L·ªói', 'Kh√¥ng th·ªÉ tr·ª´ ti·ªÅn t·ª´ s·ªë d∆∞.', 'error');
  return;
    }

    const gifts=[10000,20000,50000]; 
    const val=gifts[Math.floor(Math.random()*gifts.length)];
    // S·ª¨A: Ti·ªÅn th·∫Øng game l√† ti·ªÅn KH·∫¢ D·ª§NG
    updateBalance(val,"H·ªôp qu√† b√≠ ·∫©n", 'available');
  addExp(30);
  showToast("B·∫°n nh·∫≠n ƒë∆∞·ª£c", `+${fmt(val)} VNƒê`, 'success');
  };
  sec.appendChild(btn); c.appendChild(sec);
}

function renderBlueRedGame(c){
    let betAmount = 0;
  let chosenSide = null;
    let timer = 30;
  let countdownInterval = null;
    let gameRunning = false;

    const gameContainer = document.createElement('div');
  gameContainer.className = 'section game-container';
  const renderGame = () => {
        gameContainer.innerHTML = `
            <div class="title">üé≤ Xanh ƒê·ªè</div>
            <div id="gameStatus" class="mt8" style="font-size: 14px;"></div>
            ${!gameRunning ?
  `<button class="btn" id="startGameBtn" style="width:100%; margin-top:10px">B·∫Øt ƒë·∫ßu ch∆°i</button>` : `
            <div class="timer-display" style="font-size:48px; font-weight: 900">${timer}s</div>
            <div class="bet-input-wrapper">
                <input type="number" id="betAmount" placeholder="S·ªë ti·ªÅn c∆∞·ª£c" style="width: 80%; padding: 10px; font-size: 16px;">
            </div>
            <div class="bet-options">
           
  
                <button class="bet-btn blue" data-side="blue">ƒê·∫∑t Xanh</button>
                <button class="bet-btn red" data-side="red">ƒê·∫∑t ƒê·ªè</button>
            </div>
            `}
            <div class="card mt10">
                <div style="font-weight: bold;">L·ªãch s·ª≠ 
  k·∫øt qu·∫£:</div>
 
  
            
                <div id="resultHistory" class="result-history mt8"></div>
            </div>
        `;
  if (!gameRunning) {
            gameContainer.querySelector('#startGameBtn').onclick = () => {
                gameRunning = true;
  startCountdown();
            };
        } else {
            const betInput = gameContainer.querySelector('#betAmount');
  betInput.value = betAmount > 0 ? betAmount : '';

            const betButtons = gameContainer.querySelectorAll('.bet-btn');
  betButtons.forEach(btn => {
                if (btn.dataset.side === chosenSide) {
                    btn.style.opacity = '0.5';
                }
                btn.onclick = () => {
                    
                    if (chosenSide) return showToast('L·ªói', 'B·∫°n ƒë√£ ƒë·∫∑t c∆∞·ª£c r·ªìi.', 'error');
                    const amount = parseInt(betInput.value) || 0;
                    if (amount <= 0 || amount > balance) {
                
                      showToast('L·ªói', 'S·ªë ti·ªÅn c∆∞·ª£c kh√¥ng h·ª£p l·ªá', 'error');
       
                        return;
                    }
              
      
                  
                    // S·ª¨A: Tr·ª´ ti·ªÅn c∆∞·ª£c (m·∫∑c ƒë·ªãnh: ∆∞u ti√™n Kh·∫£ d·ª•ng tr∆∞·ªõc)
                    if (updateBalance(-amount, `C∆∞·ª£c ${fmt(amount)} VNƒê v√†o ${btn.dataset.side === 'blue' ? 'Xanh' : 'ƒê·ªè'}`)) {
          
                        betAmount = amount;
 
       
  
   
  chosenSide = btn.dataset.side;
                     
                        renderGame();
                    }
 
       
  };
  
  
  });
  }
        
        const historyDiv = gameContainer.querySelector('#resultHistory');
  blueRed.history.forEach(result => {
            const resultItem = document.createElement('div');
            resultItem.className = `result-item ${result}`;
            historyDiv.appendChild(resultItem);
        });
  };

    const startCountdown = () => {
        timer = 30;
        betAmount = 0;
  chosenSide = null;
        renderGame();
        
        countdownInterval = setInterval(() => {
            timer--;
            const timerDisplay = gameContainer.querySelector('.timer-display');
            if(timerDisplay) timerDisplay.textContent = `${timer}s`;

            if (timer <= 0) {
                clearInterval(countdownInterval);
                endRound();
  
  
            
            }
        }, 1000);
  };

    const endRound = () => {
        // S·ª¨A LOGIC: 10% th·∫Øng, 90% thua (ng∆∞·ª£c l·∫°i k·∫øt qu·∫£ c∆∞·ª£c)
        const winChance = 0.1;
  const playerWins = Math.random() < winChance;
        let result;

        if (playerWins && chosenSide) {
            // N·∫øu ng∆∞·ªùi ch∆°i th·∫Øng, k·∫øt qu·∫£ l√† b√™n ƒë√£ ch·ªçn
            result = chosenSide;
  const winnings = betAmount * 2;
            // S·ª¨A: Ti·ªÅn th·∫Øng game l√† ti·ªÅn KH·∫¢ D·ª§NG
            updateBalance(winnings, `Th·∫Øng game Xanh ƒê·ªè (x2)`, 'available');
  } else if (chosenSide) {
            // N·∫øu ng∆∞·ªùi ch∆°i thua, k·∫øt qu·∫£ l√† b√™n c√≤n l·∫°i
            result = chosenSide === 'blue' ?
  'red' : 'blue';
            // Hi·ªÉn th·ªã th√¥ng b√°o thua c∆∞·ª£c
            showToast('Thua c∆∞·ª£c', `K·∫øt qu·∫£ l√† ${result === 'blue' ? 'Xanh' : 'ƒê·ªè'}. B·∫°n ƒë√£ thua ${fmt(betAmount)} VNƒê.`, 'error');
  } else {
            // Tr∆∞·ªùng h·ª£p kh√¥ng ƒë·∫∑t c∆∞·ª£c, k·∫øt qu·∫£ ng·∫´u nhi√™n ƒë·ªÉ ghi l·ªãch s·ª≠
            result = Math.random() > 0.5 ?
  'blue' : 'red';
        }

        blueRed.history.unshift(result);
        if (blueRed.history.length > 10) blueRed.history.pop();
        
        save(LS.blueRed, blueRed);
        renderGame();
  setTimeout(startCountdown, 5000);
    };
    c.appendChild(gameContainer);
    renderGame();
}

function renderEvenOdd(c) {
    let betAmount = 0;
  let chosenSide = null;
    let timer = 30;
    let countdownInterval = null;
    let gameRunning = false;

    const gameContainer = document.createElement('div');
  gameContainer.className = 'section even-odd-game';

    const renderGame = () => {
        gameContainer.innerHTML = `
            <div class="title">üé± Ch·∫µn L·∫ª</div>
            <div id="evenOddGameStatus" class="mt8" style="font-size: 14px;"></div>
            ${!gameRunning ?
  `<button class="btn" id="startEvenOddGameBtn" style="width:100%; margin-top:10px">B·∫Øt ƒë·∫ßu ch∆°i</button>` : `
                <div class="timer-display" style="font-size:48px; font-weight: 900">${timer}s</div>
                <div class="even-odd-display" id="evenOddDisplay">${chosenSide ?
  'ƒê√£ c∆∞·ª£c' : 'ƒê·∫∑t c∆∞·ª£c ngay!'}</div>
                <div class="bet-input-wrapper">
                    <input type="number" id="evenOddBetAmount" placeholder="S·ªë ti·ªÅn c∆∞·ª£c" style="width: 80%; padding: 10px; font-size: 16px;">
                </div>
                <div class="even-odd-bet-options">
              
        <button class="even-odd-btn even" data-side="even">ƒê·∫∑t Ch·∫µn</button>
                    <button class="even-odd-btn odd" data-side="odd">ƒê·∫∑t L·∫ª</button>
                </div>
            `}
            <div class="card mt10">
                <div style="font-weight: bold;">L·ªãch s·ª≠ k·∫øt qu·∫£:</div>
   
              <div id="evenOddResultHistory" class="even-odd-result-history mt8"></div>
            </div>
        `;
  if (!gameRunning) {
            gameContainer.querySelector('#startEvenOddGameBtn').onclick = () => {
                gameRunning = true;
  startCountdown();
            };
        } else {
            const betInput = gameContainer.querySelector('#evenOddBetAmount');
  betInput.value = betAmount > 0 ? betAmount : '';

            const betButtons = gameContainer.querySelectorAll('.even-odd-btn');
  betButtons.forEach(btn => {
                if (btn.dataset.side === chosenSide) {
                    btn.style.opacity = '0.5';
                }
                btn.onclick = () => {
                    
  if (chosenSide) return showToast('L·ªói', 'B·∫°n ƒë√£ ƒë·∫∑t c∆∞·ª£c r·ªìi.', 'error');
                    const amount = parseInt(betInput.value) || 0;
                    if (amount <= 0 || amount > balance) {
                        showToast('L·ªói', 'S·ªë ti·ªÅn c∆∞·ª£c kh√¥ng h·ª£p l·ªá', 'error');
       
  return;
                    }

                    // S·ª¨A: Tr·ª´ ti·ªÅn c∆∞·ª£c (m·∫∑c ƒë·ªãnh: ∆∞u ti√™n Kh·∫£ d·ª•ng tr∆∞·ªõc)
                    if (updateBalance(-amount, `C∆∞·ª£c ${fmt(amount)} VNƒê v√†o ${btn.dataset.side === 'even' ? 'Ch·∫µn' : 'L·∫ª'}`)) {
                        betAmount = amount;
    
  chosenSide = btn.dataset.side;
                        renderGame();
                    }
                };
            });
  }
        
        const historyDiv = gameContainer.querySelector('#evenOddResultHistory');
  evenOdd.history.forEach(result => {
            const resultItem = document.createElement('div');
            resultItem.className = `even-odd-result-item ${result}`;
            resultItem.textContent = result === 'even' ? 'C' : 'L';
            historyDiv.appendChild(resultItem);
        });
  };

    const startCountdown = () => {
        timer = 30;
        betAmount = 0;
  chosenSide = null;
        renderGame();
        
        countdownInterval = setInterval(() => {
            timer--;
            const timerDisplay = gameContainer.querySelector('.timer-display');
            if(timerDisplay) timerDisplay.textContent = `${timer}s`;

            if (timer <= 0) {
                clearInterval(countdownInterval);
                endRound();
  
  }
        }, 1000);
  };

    const endRound = () => {
        const winChance = 0.1;
  const playerWins = Math.random() < winChance;
        let result;
        let randomNumber = Math.floor(Math.random() * 100);
  if (playerWins && chosenSide) {
            // N·∫øu ng∆∞·ªùi ch∆°i th·∫Øng, k·∫øt qu·∫£ l√† b√™n ƒë√£ ch·ªçn (Ch·∫µn n·∫øu ch·ªçn Ch·∫µn, L·∫ª n·∫øu ch·ªçn L·∫ª)
            result = chosenSide;
// ƒê·∫£m b·∫£o s·ªë ng·∫´u nhi√™n kh·ªõp v·ªõi k·∫øt qu·∫£
            if (result === 'even') {
                 randomNumber = Math.floor(Math.random() * 50) * 2;
// S·ªë ch·∫µn
            } else {
                 randomNumber = Math.floor(Math.random() * 50) * 2 + 1;
// S·ªë l·∫ª
            }
            const winnings = betAmount * 2;
            // S·ª¨A: Ti·ªÅn th·∫Øng game l√† ti·ªÅn KH·∫¢ D·ª§NG
  updateBalance(winnings, `Th·∫Øng game Ch·∫µn L·∫ª (x2)`, 'available');
        } else if (chosenSide) {
            // N·∫øu ng∆∞·ªùi ch∆°i thua, k·∫øt qu·∫£ l√† b√™n ng∆∞·ª£c l·∫°i
            result = chosenSide === 'even' ?
  'odd' : 'even';
            // ƒê·∫£m b·∫£o s·ªë ng·∫´u nhi√™n kh·ªõp v·ªõi k·∫øt qu·∫£ ng∆∞·ª£c l·∫°i
            if (result === 'even') {
                 randomNumber = Math.floor(Math.random() * 50) * 2;
// S·ªë ch·∫µn
            } else {
                 randomNumber = Math.floor(Math.random() * 50) * 2 + 1;
// S·ªë l·∫ª
            }
            // Hi·ªÉn th·ªã th√¥ng b√°o thua c∆∞·ª£c
            showToast('Thua c∆∞·ª£c', `K·∫øt qu·∫£ l√† ${result === 'even' ? 'Ch·∫µn' : 'L·∫ª'} (${randomNumber}). B·∫°n ƒë√£ thua ${fmt(betAmount)} VNƒê.`, 'error');
  } else {
            // Tr∆∞·ªùng h·ª£p kh√¥ng ƒë·∫∑t c∆∞·ª£c, k·∫øt qu·∫£ ng·∫´u nhi√™n ƒë·ªÉ ghi l·ªãch s·ª≠
            result = randomNumber % 2 === 0 ?
  'even' : 'odd';
        }

        const display = gameContainer.querySelector('#evenOddDisplay');
  if(display) display.textContent = `${randomNumber} (${result === 'even' ? 'Ch·∫µn' : 'L·∫ª'})`;

        evenOdd.history.unshift(result);
        if (evenOdd.history.length > 10) evenOdd.history.pop();
        
        save(LS.evenOdd, evenOdd);
        renderGame();
// Render l·∫°i game ƒë·ªÉ c·∫≠p nh·∫≠t l·ªãch s·ª≠ v√† tr·∫°ng th√°i
        setTimeout(startCountdown, 5000);
  };

    c.appendChild(gameContainer);
    renderGame();
}

function renderXO(c) {
    const WIN_REWARD = 20000;
    const LOSE_PENALTY = 10000;
  let board = ['', '', '', '', '', '', '', '', ''];
  let currentPlayer = 'X';
    let isGameActive = true;
  const gameContainer = document.createElement('div');
    gameContainer.className = 'section center';
  gameContainer.innerHTML = `
      <div class="title">‚ùå‚≠ï Tr√≤ ch∆°i XO</div>
      <div class="card mt8">
        <p id="gameStatus">L∆∞·ª£t c·ªßa b·∫°n (X)</p>
      </div>
      <div class="xo-board">
        ${board.map((_, i) => `<div class="xo-cell" data-index="${i}"></div>`).join('')}
      </div>
      <button class="btn mt10" id="resetBtn">Ch∆°i l·∫°i</button>
      <div class="card mt10">
        <div class="stats-grid">
 
            <div class="stat">Th·∫Øng: <span class="big">${xoState.wins}</span></div>
          <div class="stat">Thua: <span class="big">${xoState.losses}</span></div>
          <div class="stat">H√≤a: <span class="big">${xoState.draws}</span></div>
        </div>
      </div>
    `;
  const cells = gameContainer.querySelectorAll('.xo-cell');
    const statusDisplay = gameContainer.querySelector('#gameStatus');
    const resetBtn = gameContainer.querySelector('#resetBtn');
  const winningConditions = [
      [0, 1, 2], [3, 4, 5], [6, 7, 8],
      [0, 3, 6], [1, 4, 7], [2, 5, 8],
      [0, 4, 8], [2, 5, 6]
    ];
  function handleResultValidation() {
        let roundWon = false;
  for (let i = 0; i < winningConditions.length; i++) {
            const winCondition = winningConditions[i];
  let a = board[winCondition[0]];
            let b = board[winCondition[1]];
            let c = board[winCondition[2]];
  if (a === '' || b === '' || c === '') continue;
  if (a === b && b === c) {
                roundWon = true;
  break;
            }
        }

        if (roundWon) {
            statusDisplay.textContent = `Ng∆∞·ªùi ch∆°i ${currentPlayer} ƒë√£ th·∫Øng!`;
  isGameActive = false;
            if (currentPlayer === 'X') {
                xoState.wins++;
  // S·ª¨A: Ti·ªÅn th·∫Øng game l√† ti·ªÅn KH·∫¢ D·ª§NG
  updateBalance(WIN_REWARD, "Th·∫Øng XO", 'available');
            } else {
                xoState.losses++;
  // S·ª¨A: Ti·ªÅn thua game (ph√≠) l√† tr·ª´ chung (m·∫∑c ƒë·ªãnh)
  updateBalance(-LOSE_PENALTY, "Thua XO");
  }
            save(LS.xo, xoState);
            renderContent();
            return;
  }

        if (!board.includes('')) {
            statusDisplay.textContent = `Tr·∫≠n ƒë·∫•u h√≤a!`;
  isGameActive = false;
            xoState.draws++;
            save(LS.xo, xoState);
            renderContent();
            return;
        }

        currentPlayer = currentPlayer === 'X' ?
  'O' : 'X';
        statusDisplay.textContent = `L∆∞·ª£t c·ªßa ${currentPlayer}`;
    }

    function handleCellClick(clickedCell, clickedCellIndex) {
        if (board[clickedCellIndex] !== '' || !isGameActive) return;
  board[clickedCellIndex] = currentPlayer;
        clickedCell.textContent = currentPlayer;
        clickedCell.classList.add(currentPlayer);
        handleResultValidation();
        if(isGameActive && currentPlayer === 'O') {
            setTimeout(computerTurn, 500);
  }
    }

    function computerTurn() {
        let emptyCells = board.map((cell, i) => cell === '' ? i : null).filter(val => val !== null);
  let bestMove = -1;

        // Try to win
        for(let i of emptyCells) {
            let tempBoard = [...board];
  tempBoard[i] = 'O';
            if(checkWin(tempBoard, 'O')) { bestMove = i; break;
  }
        }

        // Block player from winning
        if(bestMove === -1) {
            for(let i of emptyCells) {
                let tempBoard = [...board];
  tempBoard[i] = 'X';
                if(checkWin(tempBoard, 'X')) { bestMove = i; break;
  }
            }
        }
        
        // Take center or corners
        if(bestMove === -1 && emptyCells.includes(4)) bestMove = 4;
  if(bestMove === -1) {
            const corners = [0, 2, 6, 8];
  const availableCorners = emptyCells.filter(i => corners.includes(i));
            if(availableCorners.length > 0) bestMove = availableCorners[Math.floor(Math.random() * availableCorners.length)];
  }

        // Take any side
        if(bestMove === -1) {
            const sides = [1, 3, 5, 7];
  const availableSides = emptyCells.filter(i => sides.includes(i));
            if(availableSides.length > 0) bestMove = availableCorners[Math.floor(Math.random() * availableSides.length)];
  }


        if (bestMove !== -1) {
            handleCellClick(cells[bestMove], bestMove);
  }
    }

    function checkWin(board, player) {
        for (let i = 0; i < winningConditions.length; i++) {
            const [a, b, c] = winningConditions[i];
  if (board[a] === player && board[b] === player && board[c] === player) {
                return true;
  }
        }
        return false;
  }

    cells.forEach((cell, index) => {
        cell.addEventListener('click', () => handleCellClick(cell, index));
    });
  resetBtn.addEventListener('click', () => {
        board = ['', '', '', '', '', '', '', '', ''];
        isGameActive = true;
        currentPlayer = 'X';
        statusDisplay.textContent = `L∆∞·ª£t c·ªßa b·∫°n (X)`;
        cells.forEach(cell => {
            cell.textContent = '';
            cell.classList.remove('X', 'O');
        });
 
  
    
    });

    c.appendChild(gameContainer);
}
// NEW: Crypto render function
let currentCryptoPrice = 100;
let cryptoPriceInterval = null;
function renderCrypto(c) {
    const sec = document.createElement('div');
    sec.className = 'section';
    sec.innerHTML = `
        <div class="title">üöÄ Giao d·ªãch ti·ªÅn ·∫£o</div>
        <div class="card mt8">
            <div class="crypto-chart">
                <div class="chart-price" id="cryptoPrice">${fmt(currentCryptoPrice)} VNƒê</div>
            </div>
            <div class="mt10">
              <div class="row">
   
                <div class="muted">S·ªë d∆∞ VNƒê: ${fmt(balance)}</div>
                <div class="muted">S·ªë Coin: ${cryptoState.coinBalance.toFixed(2)} GO</div>
              </div>
              <div class="row mt8">
                <div class="muted">ƒê√£ ƒë·∫ßu t∆∞: ${fmt(cryptoState.investedVND)} VNƒê</div>
       
  
                <div class="muted">Gi√° tr·ªã hi·ªán t·∫°i: ${fmt(cryptoState.coinBalance * currentCryptoPrice)} VNƒê</div>
              </div>
            </div>
            <input type="number" id="tradeAmount" placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng Coin" style="width:100%;padding:10px;margin-top:10px;">
            <div class="crypto-actions mt10">
             
   
 
              <button class="btn buy-btn" id="buyBtn">Mua</button>
          
                <button class="btn sell-btn" id="sellBtn">B√°n</button>
            </div>
        </div>
    `;
    c.appendChild(sec);
    
    // Start price simulation
    if (cryptoPriceInterval) clearInterval(cryptoPriceInterval);
    cryptoPriceInterval = setInterval(() => {
        const change = (Math.random() - 0.5) * 5; // Price change between -2.5 and +2.5
        currentCryptoPrice = Math.max(1, currentCryptoPrice + change);
        const priceEl = $('#cryptoPrice');
        if (priceEl) {
            priceEl.textContent = fmt(currentCryptoPrice) + ' VNƒê';
            priceEl.classList.toggle('price-up', change > 0);
        
  
  
            priceEl.classList.toggle('price-down', change < 0);
        } else {
            clearInterval(cryptoPriceInterval);
        }
    }, 1000);
    $('#buyBtn').onclick = () => {
        const amount = parseFloat($('#tradeAmount').value) || 0;
  const cost = amount * currentCryptoPrice;
        if (amount <= 0) return showToast('L·ªói', 'S·ªë l∆∞·ª£ng kh√¥ng h·ª£p l·ªá.', 'error');
  if (balance < cost) return showToast('L·ªói', 'Kh√¥ng ƒë·ªß VNƒê ƒë·ªÉ mua.', 'error');

        // S·ª¨A: Ti·ªÅn mua coin l√† ti·ªÅn tr·ª´ chung (m·∫∑c ƒë·ªãnh)
        updateBalance(-cost, `Mua ${amount} GO`);
        cryptoState.coinBalance += amount;
  cryptoState.investedVND += cost;
        save(LS.crypto, cryptoState);
        renderContent();
    };

    $('#sellBtn').onclick = () => {
        const amount = parseFloat($('#tradeAmount').value) ||
  0;
        const profit = amount * currentCryptoPrice;
        if (amount <= 0) return showToast('L·ªói', 'S·ªë l∆∞·ª£ng kh√¥ng h·ª£p l·ªá.', 'error');
  if (cryptoState.coinBalance < amount) return showToast('L·ªói', 'Kh√¥ng ƒë·ªß GO ƒë·ªÉ b√°n.', 'error');

        // S·ª¨A: Ti·ªÅn b√°n coin l√† ti·ªÅn KH·∫¢ D·ª§NG (coi nh∆∞ th·∫Øng ƒë·∫ßu t∆∞)
        updateBalance(profit, `B√°n ${amount} GO`, 'available');
        cryptoState.coinBalance -= amount;
  cryptoState.investedVND -= (amount / cryptoState.coinBalance) * cryptoState.investedVND;
        save(LS.crypto, cryptoState);
        renderContent();
    };
}


// M·ªöI: Th√™m h√†m Render cho ch·ª©c nƒÉng ƒê√†o Xu (renderCryptoMine)
function renderCryptoMine(c) {
    const REWARD = 300; // 300 GO Coin
    const COOLDOWN = 3600000; // 1 gi·ªù = 3600 gi√¢y = 3,600,000 miligi√¢y
    const now = Date.now();
    const timeElapsed = now - mineLastTime;
    const canMine = timeElapsed >= COOLDOWN;
    
    let countdownInterval = null;

    const sec = document.createElement('div');
    sec.className = 'section center';
    
    const updateMineUI = () => {
        sec.innerHTML = `
            <div class="title">‚õèÔ∏è ƒê√†o Xu Mi·ªÖn Ph√≠</div>
            <div class="card mt8">
                <div style="font-size: 16px; font-weight: bold; color: var(--success);">Ph·∫ßn th∆∞·ªüng: +${REWARD} GO Coin</div>
                <div class="muted mt8">B·∫°n c√≥ th·ªÉ ƒë√†o xu sau m·ªói **1 gi·ªù**.</div>
                <div class="muted mt8">S·ªë Coin hi·ªán c√≥: **${cryptoState.coinBalance.toFixed(2)} GO**</div>
            </div>
            <div class="card mt10">
                <div id="mineStatus" style="font-size: 18px; font-weight: 900; margin-bottom: 10px;"></div>
                <button class="btn" id="mineBtn" style="width:100%; font-size: 18px; padding: 15px 10px;" ${canMine ? '' : 'disabled'}>
                    ${canMine ? 'B·∫Øt ƒë·∫ßu ƒê√†o Xu' : 'ƒêang ch·ªù...'}
                </button>
            </div>
        `;

        const mineBtn = sec.querySelector('#mineBtn');
        const statusDiv = sec.querySelector('#mineStatus');

        if (canMine) {
            statusDiv.textContent = "S·∫µn s√†ng nh·∫≠n th∆∞·ªüng!";
            if (countdownInterval) clearInterval(countdownInterval);

            mineBtn.onclick = () => {
                // Logic nh·∫≠n th∆∞·ªüng
                cryptoState.coinBalance += REWARD;
                mineLastTime = Date.now();
                save(LS.crypto, cryptoState);
                save(LS.mineLastTime, String(mineLastTime));
                showToast("Th√†nh c√¥ng", `B·∫°n ƒë√£ nh·∫≠n ${REWARD} GO Coin!`, 'success');
                renderContent(); // Render l·∫°i ƒë·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i v√† k√≠ch ho·∫°t countdown
            };

        } else {
            mineBtn.textContent = "ƒêang ch·ªù...";
            
            // C·∫≠p nh·∫≠t UI m·ªói gi√¢y
            if (!countdownInterval) {
                countdownInterval = setInterval(() => {
                    const newTimeLeft = COOLDOWN - (Date.now() - mineLastTime);
                    if (newTimeLeft <= 0) {
                        clearInterval(countdownInterval);
                        renderContent(); // K√≠ch ho·∫°t render l·∫°i ƒë·ªÉ chuy·ªÉn sang tr·∫°ng th√°i "Can Mine"
                        return;
                    }
                    const hours = Math.floor(newTimeLeft / 3600000);
                    const minutes = Math.floor((newTimeLeft % 3600000) / 60000);
                    const seconds = Math.floor((newTimeLeft % 60000) / 1000);
                    statusDiv.textContent = `Th·ªùi gian ch·ªù: ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);
            }
        }
    };

    c.appendChild(sec);
    updateMineUI();
}


function renderShop(c){
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML=`<div class="title">üõçÔ∏è C·ª≠a h√†ng</div>`;
  const grid=document.createElement('div'); grid.className='shop-grid';
  const items=[{id:'c1',name:'Coupon +10k',price:10000},{id:'exp50',name:'EXP +50',price:20000}];
  items.forEach(it=>{
    const el=document.createElement('div'); el.className='item';
    el.innerHTML=`<h4>${it.name}</h4><div class="price">${fmt(it.price)} VNƒê</div>
      <button class="main-btn mt8" style="width:100%">Mua</button>`;
    el.querySelector('button').onclick=()=>{
      // S·ª¨A: Tr·ª´ ti·ªÅn mua (m·∫∑c ƒë·ªãnh: ∆∞u ti√™n Kh·∫£ d·ª•ng tr∆∞·ªõc)
      if(updateBalance(-it.price,'Mua '+it.name)){ inventory.push(it); save(LS.inventory,inventory); addExp(20); renderContent(); }
      else showToast('Kh√¥ng ƒë·ªß s·ªë d∆∞','N·∫°p th√™m ƒë·ªÉ mua','error');
    };
    grid.appendChild(el);
  });
  sec.appendChild(grid); c.appendChild(sec);
}
function renderInventory(c){
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML=`<div class="title">üéí Kho ƒë·ªì</div>`;
  if(inventory.length===0) sec.innerHTML+='<div class="muted">Ch∆∞a c√≥ v·∫≠t ph·∫©m</div>';
  else {
    const box=document.createElement('div'); box.className='card';
    box.innerHTML = inventory.map(it=>`‚Ä¢ ${it.name}`).join('<br>');
    sec.appendChild(box);
  }
  c.appendChild(sec);
}

function renderWallet(c){
    // M·ª®C R√öT T·ªêI THI·ªÇU M·ªöI
    const MIN_WITHDRAWAL = 250000; 

    const sec=document.createElement('div'); 
    sec.className='section';
    // C·∫¨P NH·∫¨T: CH·ªà HI·ªÇN TH·ªä T·ªîNG S·ªê D∆Ø v√† th√¥ng b√°o c·∫£nh b√°o m·ªõi
    sec.innerHTML=`
        <div class="title">üí∞ T·ªïng S·ªë d∆∞: ${fmt(balance)} VNƒê</div>
        <div class="card mt8 center" style="border: 2px solid var(--red); box-shadow: 0 4px 12px rgba(250, 82, 82, 0.4);">
            <p style="font-weight: bold; color: var(--red);">
                Kh√¥ng spam r√∫t khi ch∆∞a ƒë·ªß ƒëi·ªÅu ki·ªán, ƒë·ªçc kƒ© ƒëi·ªÅu ki·ªán r√∫t. Tr√¢n tr·ªçng c·∫£m ∆°n.
            </p>
            <p class="muted" style="font-size: 11px; margin-top: 8px;">
                ch·ªâ ƒë∆∞·ª£c ph√©p r√∫t khi t·ª´ vip m·ªôt tr·ªü l√™n , r√∫t qu√° 10p ti·ªÅn ch∆∞a v·ªÅ li√™n h·ªá ƒë·ªÉ ƒëc h·ªó tr·ª£ .
            </p>
        </div>
    `;
    
    if (pendingDeposit) {
        const pendingAlert = document.createElement('div');
        pendingAlert.className = 'pending-deposit-alert';
        pendingAlert.innerHTML = `
            <i class="fa-solid fa-hourglass-half"></i>
            <span class="muted">Giao d·ªãch n·∫°p ${fmt(pendingDeposit.amount)} VNƒê ƒëang ch·ªù x·ª≠ l√Ω...</span>
        `;
        sec.appendChild(pendingAlert);
    }
    
    const linkBankCard = document.createElement('div');
    linkBankCard.className = 'card mt8 center';
    if (linkedBank) {
        linkBankCard.innerHTML = `
            <div style="font-weight: bold;">Ng√¢n h√†ng ƒë√£ li√™n k·∫øt:</div>
            <div class="bank-info mt8">
                <div class="bank-logo">
                    ${linkedBank.logo}
                </div>
                <div>
                    <div><b>${linkedBank.name}</b></div>
                    <div class="muted">${linkedBank.accountNumber}</div>
                </div>
            </div>
            <button class="btn mt10" id="chgBank">ƒê·ªïi</button>`;
    } else {
        linkBankCard.innerHTML = `
            <div class="muted">B·∫°n ch∆∞a li√™n k·∫øt ng√¢n h√†ng.</div>
            <div class="muted mt8" style="font-size:12px;">Li√™n k·∫øt ng√¢n h√†ng ch√≠nh ch·ªß ƒë·ªÉ c√≥ th·ªÉ R√öT TI·ªÄN.</div>
            <button class="btn mt10" id="lnkBank">Li√™n k·∫øt ngay</button>`;
    }
    sec.appendChild(linkBankCard);
    
    const lnkBankBtn = linkBankCard.querySelector('#lnkBank');
    const chgBankBtn = linkBankCard.querySelector('#chgBank');
    if (lnkBankBtn) lnkBankBtn.onclick = showBankLink;
    if (chgBankBtn) chgBankBtn.onclick = showBankLink;


    // Withdrawal Section
    const withdrawSec = document.createElement('div');
    withdrawSec.className = 'section mt10';
    withdrawSec.innerHTML = `<div class="title">R√∫t ti·ªÅn</div>`;
    
    const withdrawForm = document.createElement('div');
    withdrawForm.className = 'card mt8';
    // C·∫¨P NH·∫¨T: Hi·ªÉn th·ªã m·ª©c r√∫t t·ªëi thi·ªÉu M·ªöI
    withdrawForm.innerHTML = `<input id="wAmount" type="number" placeholder="S·ªë ti·ªÅn mu·ªën r√∫t (Min: ${fmt(MIN_WITHDRAWAL)}, Max: ${fmt(availableBalance)})" style="width:100%;padding:10px;margin:6px 0;">
                              <button class="withdraw-btn" id="wBtn" style="width:100%">R√∫t</button>`;
    withdrawForm.querySelector('#wBtn').onclick = () => {
        const { currentVip } = calculateVipLevel();
        if (currentVip < 1) {
            return showToast('L·ªói', 'B·∫°n c·∫ßn ƒë·∫°t c·∫•p VIP 1 tr·ªü l√™n ƒë·ªÉ r√∫t ti·ªÅn.', 'error');
        }
        if (!linkedBank) {
            return showToast('L·ªói', 'Vui l√≤ng li√™n k·∫øt ng√¢n h√†ng tr∆∞·ªõc khi r√∫t ti·ªÅn.', 'error');
        }
        
        const amt = parseInt(withdrawForm.querySelector('#wAmount').value) || 0;
        // KI·ªÇM TRA M·ª®C R√öT T·ªêI THI·ªÇU M·ªöI
        if (amt < MIN_WITHDRAWAL) return showToast(`T·ªëi thi·ªÉu ${fmt(MIN_WITHDRAWAL)}`, `S·ªë ti·ªÅn r√∫t ph·∫£i t·ª´ ${fmt(MIN_WITHDRAWAL)} VNƒê tr·ªü l√™n.`, 'error');
        
        // KI·ªÇM TRA CH·ªà R√öT ƒê∆Ø·ª¢C TI·ªÄN KH·∫¢ D·ª§NG
        if (availableBalance < amt) return showToast('Kh√¥ng ƒë·ªß ti·ªÅn Kh·∫£ d·ª•ng', `B·∫°n ch·ªâ c√≥ th·ªÉ r√∫t t·ªëi ƒëa ${fmt(availableBalance)} VNƒê.`, 'error');
        
        // D√πng updateBalance ƒë·ªÉ tr·ª´ ti·ªÅn kh·ªèi Kh·∫£ d·ª•ng
        if (updateBalance(-amt, `R√∫t ti·ªÅn v·ªÅ ${linkedBank.name}`)) { 
            withdrawHistory.unshift({time: nowVN(), amount: amt, bank: linkedBank.name});
            save(LS.withdraw, withdrawHistory);
            showWithdrawAlert(user.name, amt);
            renderContent();
        }
    };
    withdrawSec.appendChild(withdrawForm);
    
    c.appendChild(sec);
    c.appendChild(withdrawSec);
}

const DEPOSIT_CODES = [
  "AZ9T4GBN", "K3PQ8LMN", "J7FH2ECD", "R4TG6YUI", "E8W2AZXC", 
  "9H8JKL32", "Q3VT4BNM", "7G4FH8JK", "C9D8EFGH", "V2B8N4ZA", 
  "X5C9VBN8", "T7G3F2DE", "M4N8LKJH", "F2G5H8JK", "B9N4M2ZA", 
  "P8L4K3GH", "H9G8F7ED", "N4V8B2XC", "G5T6Y7UI", "D8C9V4BN",
    "JFHF7J", "X45VQQ", "HHB76Z", "WD1GSV1P", "DRJ3IER", "R36CLS", "EEXNQVO0", "KEHRSJ", "UBE24T7L", "ZLJUAUC",
    "4V807QSG", "777GTE", "L39I8C4J", "ULLDKLTP", "9BEAROK5", "YQ0ZRL", "CXAPTV", "B14KSXAB", "W90KZA", "66I9WI8",
    "PFV4VG", "OHA57R2", "4OX7GVV8", "JNSJ4Z2Z", "BIOSVATI", "ENN7VG", "527Q612W", "3PFFOC", "E4BK5MW", "OBZNWC",
    "EV0X4FQ", "EU4OFEEV", "SOY364", "H6Z934", "1A6P3KJZ", "ACBCBPN", "C19A60T", "7C8HIEF6", "9LVEKX0", "F96TGP",
    "JS0P8GG", "MPW5AJH", "0KPAOEHT", "9TGHHO4", "E021S0LB", "6K7NNW9V", "GFXS2N", "HM99A8F", "3CCS5PM", "Y5XMXE6",
    "FWK6BSE", "GXKXU247", "FHF9Z2", "RH3IW4", "Z9083SWA", "TKY27NE", "SY818J22", "MX2VSWX", "9Z1N65", "8G377PG",
    "VOLXJIFB", "3ZMCE8", "8RVUYQ", "MIBD5GQ", "QTVZL2", "A0QY7JQ", "J2R1FN", "0HVNGL", "I4BZES4", "Y22VG0",
    "3VMPTHM", "XXPXAZ", "V22KDR", "37X8E0D", "7W2R8J", "OIQCKVQ", "1K3FEJ", "7G5BMA8", "CZY41J0", "2Y49IVQ",
    "0WBIVH", "MJU40L", "SZJD7OL", "VCP3WO", "KQF92I", "X3A0KUL", "S7JQTV", "L89JGOT", "H7K2U5", "8T0AKW",
    "D7Z6P2", "UM05H1", "4VYOCF", "6I92G5", "LPOB7I", "YN6Z0U"
];
let usedDepositCodes = load('gogo.usedDepositCodes') || {};
function renderDeposit(c) {
  const sec = document.createElement('div');
  sec.className = 'section';
  sec.innerHTML = `<div class="title">üíµ N·∫°p ti·ªÅn</div>`;

  const infoCard = document.createElement('div');
  infoCard.className = 'card';
  infoCard.innerHTML = `<div class="muted">N·∫°p ti·ªÅn v√†o v√≠ c·ªßa b·∫°n. Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn mu·ªën n·∫°p ƒë·ªÉ l·∫•y th√¥ng tin chuy·ªÉn kho·∫£n.
n·∫øu n·∫°p m√† m√£ ch∆∞a g·ª≠i hay ti·ªÅn ch∆∞a c·ªông li√™n h·ªá ngay ADMIN.</div>`;
  sec.appendChild(infoCard);

  const depositForm = document.createElement('div');
  depositForm.className = 'card mt10';
  depositForm.innerHTML = `
    <input id="dAmount" type="number" placeholder="S·ªë ti·ªÅn mu·ªën n·∫°p (>= 10,000)" style="width:100%;padding:10px;margin:6px 0;">
    <button class="deposit-btn" id="dBtn" style="width:100%">Ti·∫øp t·ª•c</button>`;
  depositForm.querySelector('#dBtn').onclick = () => {
    const amt = parseInt(depositForm.querySelector('#dAmount').value) || 0;
  if (amt < 10000) return showToast('T·ªëi thi·ªÉu 10k', 'S·ªë ti·ªÅn n·∫°p ph·∫£i t·ª´ 10.000 VNƒê tr·ªü l√™n.', 'error');
    showDepositInfo(amt);
  };
  sec.appendChild(depositForm);
  
  // NEW: Th√™m khu v·ª±c nh·∫≠p m√£ x√°c nh·∫≠n n·∫°p ti·ªÅn (ƒê√£ s·ª≠a CSS v√† placeholder)
  const confirmationSection = document.createElement('div');
  confirmationSection.id = 'depositConfirmationSection';
  confirmationSection.className = 'section mt10 deposit-confirmation-section'; // Th√™m class CSS nh·∫•p nh√°y
  confirmationSection.style.display = 'none'; // ·∫®n ban ƒë·∫ßu
  confirmationSection.innerHTML = `
    <div class="title" style="color:white; margin-bottom:0;">üîë X√°c nh·∫≠n N·∫°p ti·ªÅn</div>
    <div class="card mt8" style="background: rgba(255,255,255,.25);">
        <p class="muted" id="depositConfirmText" style="color:white;">Vui l√≤ng nh·∫≠p **M√£ X√°c Nh·∫≠n** (M√£ giao d·ªãch) ƒë·ªÉ h·ªá th·ªëng c·ªông ti·ªÅn v√†o t√†i kho·∫£n.</p>
        <input type="text" id="confirmCodeInput" placeholder="Nh·∫≠p m√£ x√°c nh·∫≠n" style="width:100%;padding:10px;margin:10px 0;">
        <button class="deposit-btn" id="confirmDepositBtn" style="width:100%; background: var(--brand); color: #212529; ">X√°c nh·∫≠n Giao d·ªãch</button>
    </div>
  `;
  
  sec.appendChild(confirmationSection);
  c.appendChild(sec);
}
// H√ÄM SAO CH√âP CHUNG
function copyText(text, title) {
    navigator.clipboard.writeText(text).then(() => {
        showToast('ƒê√£ sao ch√©p', `ƒê√£ sao ch√©p ${title}: ${text}`, 'info');
    }).catch(err => {
        showToast('L·ªói sao ch√©p', 'Kh√¥ng th·ªÉ sao ch√©p vƒÉn b·∫£n t·ª± ƒë·ªông.', 'error');
    });
}
window.copyText = copyText; // Export ra global ƒë·ªÉ d√πng trong onclick

function showDepositInfo(amount) {
    const overlay = document.createElement('div');
    overlay.className = 'overlay';

    const box = document.createElement('div');
  box.className = 'modal';

    // Simulated bank account information
    const bankInfo = {
        name: 'MB Bank',
        accountHolder: 'DINH ANH CHANG',
        accountNumber: '0394539007',
        transferContent: 'N·∫°p ti·ªÅn v√†o gogo lite',
        qrCode: 'https://cdn.example.com/tcb_qr.png'
    };
  
    // THAY ƒê·ªîI L·ªöN: Th√™m n√∫t Copy v√†o c√°c tr∆∞·ªùng th√¥ng tin
    const accNumber = bankInfo.accountNumber;
    const accHolder = bankInfo.accountHolder;
    const tContent = bankInfo.transferContent;
    const amtFmt = fmt(amount);

    box.innerHTML = `
        <div class="row">
            <h3 style="margin:0; flex:1">Th√¥ng tin n·∫°p ti·ªÅn</h3>
            <button type="button" class="btn secondary" id="closeDeposit">ƒê√≥ng</button>
        </div>
        <div class="card mt10">
            <div class="bank-info" style="align-items: flex-start;">
                <div style="flex-basis: 35%;">
                    <div style="font-weight: bold;">Ng√¢n h√†ng:</div>
                    <div class="mt8">T√™n t√†i kho·∫£n:</div>
                    <div class="mt8">S·ªë t√†i kho·∫£n:</div>
                    <div class="mt8">N·ªôi dung CK:</div>
                    <div class="mt8">S·ªë ti·ªÅn:</div>
                </div>
                <div style="flex-basis: 65%;">
                    <div style="font-weight: bold; color: var(--brand);">${bankInfo.name}</div>
                    
                    <div class="mt8">
                        ${accHolder}
                        <button class="copy-btn" onclick="copyText('${accHolder}', 'T√™n TK')">Sao ch√©p</button>
                    </div>
                    
                    <div class="mt8">
                        ${accNumber}
                        <button class="copy-btn" onclick="copyText('${accNumber}', 'S·ªë TK')">Sao ch√©p</button>
                    </div>
                    
                    <div class="mt8">
                        ${tContent}
                        <button class="copy-btn" onclick="copyText('${tContent}', 'N·ªôi dung')">Sao ch√©p</button>
                    </div>
                    
                    <div class="mt8" style="color: var(--brand); font-weight: bold;">
                        ${amtFmt} VNƒê
                        <button class="copy-btn" onclick="copyText('${amount}', 'S·ªë ti·ªÅn')">Sao ch√©p</button>
                    </div>
                </div>
            </div>
            <div class="center mt10">
                <p class="muted" style="font-size: 11px;">Vui l√≤ng chuy·ªÉn kho·∫£n **ƒë√∫ng s·ªë ti·ªÅn v√† n·ªôi dung** ƒë·ªÉ ƒë∆∞·ª£c c·ªông t·ª± ƒë·ªông.</p>
            </div>
        </div>
        <button class="deposit-btn mt10" style="width: 100%" id="confirmDeposit">ƒê√£ chuy·ªÉn kho·∫£n</button>
    `;
  box.querySelector('#closeDeposit').onclick = () => overlay.remove();

    box.querySelector('#confirmDeposit').onclick = () => {
        // Chuy·ªÉn sang ph·∫ßn x√°c nh·∫≠n m√£
        overlay.remove();
        const confirmationSection = $('#depositConfirmationSection');
        if (confirmationSection) {
            confirmationSection.style.display = 'block';
            $('#depositConfirmText').innerHTML = `X√°c nh·∫≠n n·∫°p **${fmt(amount)} VNƒê**. Vui l√≤ng nh·∫≠p m√£ x√°c nh·∫≠n.`;
            $('#confirmCodeInput').value = ''; // X√≥a m√£ c≈©

            const confirmBtn = $('#confirmDepositBtn');
            // G√°n s·ª± ki·ªán x√°c nh·∫≠n m√£
            confirmBtn.onclick = () => {
                const code = $('#confirmCodeInput').value.trim().toUpperCase();
                
                if (DEPOSIT_CODES.includes(code)) {
                    if (usedDepositCodes[code]) {
                        return showToast('M√£ ƒë√£ s·ª≠ d·ª•ng', 'M√£ x√°c nh·∫≠n n√†y ƒë√£ ƒë∆∞·ª£c d√πng cho giao d·ªãch tr∆∞·ªõc ƒë√≥.', 'error');
                    }
                    
                    // S·ª¨A: Ti·ªÅn n·∫°p l√† ti·ªÅn ƒê√ìNG BƒÇNG (m·∫∑c ƒë·ªãnh)
                    if (updateBalance(amount, `N·∫°p ti·ªÅn qua m√£ x√°c nh·∫≠n ${code}`)) {
                        usedDepositCodes[code] = true;
                        save('gogo.usedDepositCodes', usedDepositCodes);
                        addExp(50);
                        confirmationSection.style.display = 'none';
                        showToast('N·∫°p ti·ªÅn th√†nh c√¥ng', `ƒê√£ c·ªông ${fmt(amount)} VNƒê v√†o t√†i kho·∫£n!`, 'success');
                        renderContent();
                    }
                } else {
                    showToast('M√£ kh√¥ng h·ª£p l·ªá', 'M√£ x√°c nh·∫≠n kh√¥ng ƒë√∫ng ho·∫∑c h·∫øt h·∫°n. Vui l√≤ng ki·ªÉm tra l·∫°i.', 'error');
                }
            };
        }
    };

  
  overlay.appendChild(box);
    document.body.appendChild(overlay);
}

function renderTx(c){
  const sec=document.createElement('div');
  sec.className='section';
  sec.innerHTML=`<div class="title">üßæ Giao d·ªãch g·∫ßn ƒë√¢y</div>`;
  const tbl=document.createElement('table'); tbl.className='table';
  tbl.innerHTML='<thead><tr><th>Th·ªùi gian</th><th>L√Ω do</th><th>S·ªë ti·ªÅn</th></tr></thead><tbody></tbody>';
  const tb=tbl.querySelector('tbody');
  transactions.slice(0,10).forEach(tx=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${tx.time}</td><td>${tx.reason}</td><td>${tx.amount>0?'+':''}${fmt(tx.amount)}</td>`;
    tb.appendChild(tr);
  });
  sec.appendChild(tbl); c.appendChild(sec);
}
function renderWithdrawHistory(c){
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML=`<div class="title">üè¶ L·ªãch s·ª≠ r√∫t</div>`;
  const tbl=document.createElement('table'); tbl.className='table';
  tbl.innerHTML='<thead><tr><th>Th·ªùi gian</th><th>Ng√¢n h√†ng</th><th>S·ªë ti·ªÅn</th></tr></thead><tbody></tbody>';
  const tb=tbl.querySelector('tbody');
  withdrawHistory.slice(0,10).forEach(w=>{
    const tr=document.createElement('tr'); 
    tr.innerHTML=`<td>${w.time}</td><td>${w.bank || 'Ch∆∞a li√™n k·∫øt'}</td><td>${fmt(w.amount)} VNƒê</td>`; 
    tb.appendChild(tr);
  });
  sec.appendChild(tbl); c.appendChild(sec);
}

// C·∫¨P NH·∫¨T L·ªöN: Th√™m tr∆∞·ªùng phone v√† email
function renderProfile(c){
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML=`<div class="title">üë§ H·ªì s∆° C√° nh√¢n</div>`;
  const card=document.createElement('div'); card.className='card';
  card.innerHTML = `
    <div><b>Avatar:</b> <span id="avatarShow" style="font-size:22px">${user.avatar||'üü°'}</span></div>
    <div class="mt8"><input id="nameInp" value="${user.name}" style="width:100%;padding:10px" placeholder="T√™n hi·ªÉn th·ªã"></div>
    <div class="mt8"><input id="avatarInp" value="${user.avatar||'üü°'}" style="width:100%;padding:10px" placeholder="Emoji avatar (vd: üü°, üò∫)"></div>
    
    <div class="mt10" style="font-weight: bold; opacity: 0.8;">üìû S·ªë ƒëi·ªán tho·∫°i</div>
    <div class="mt8"><input id="phoneInp" type="tel" value="${user.phone||''}" style="width:100%;padding:10px" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i c·ªßa b·∫°n"></div>
    
    <div class="mt10" style="font-weight: bold; opacity: 0.8;">üìß ƒê·ªãa ch·ªâ Gmail</div>
    <div class="mt8"><input id="emailInp" type="email" value="${user.email||''}" style="width:100%;padding:10px" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ Gmail"></div>

    <button class="main-btn mt10" style="width:100%" id="saveProfile">L∆∞u thay ƒë·ªïi</button>`;
  
  card.querySelector('#saveProfile').onclick=()=>{
    user.name=$('#nameInp').value.trim()||'Kh√°ch';
    user.avatar=$('#avatarInp').value.trim()||'üü°';
    // L∆ØU C√ÅC TH√îNG TIN M·ªöI
    user.phone=$('#phoneInp').value.trim()||'';
    user.email=$('#emailInp').value.trim()||'';
    
    save(LS.user,user); 
    renderHeader(); 
    renderContent();
    showToast("Th√†nh c√¥ng", "ƒê√£ l∆∞u th√¥ng tin h·ªì s∆°!", "success");
  };
  sec.appendChild(card); c.appendChild(sec);
}
function renderRedeem(c){
  const validCodes = [
    "JFHF7J", "X45VQQ", "HHB76Z", "WD1GSV1P", "DRJ3IER", "R36CLS", "EEXNQVO0", "KEHRSJ", "UBE24T7L", "ZLJUAUC",
    "4V807QSG", "777GTE", "L39I8C4J", "ULLDKLTP", "9BEAROK5", "YQ0ZRL", "CXAPTV", "B14KSXAB", "W90KZA", "66I9WI8",
    "PFV4VG", "OHA57R2", "4OX7GVV8", "JNSJ4Z2Z", "BIOSVATI", "ENN7VG", "527Q612W", "3PFFOC", "E4BK5MW", "OBZNWC",
    "EV0X4FQ", "EU4OFEEV", "SOY364", "H6Z934", "1A6P3KJZ", "ACBCBPN", "C19A60T", "7C8HIEF6", "9LVEKX0", "F96TGP",
    "JS0P8GG", "MPW5AJH", "0KPAOEHT", "9TGHHO4", "E021S0LB", "6K7NNW9V", "GFXS2N", "HM99A8F", "3CCS5PM", "Y5XMXE6",
    "FWK6BSE", "GXKXU247", "FHF9Z2", "RH3IW4", "Z9083SWA", "TKY27NE", "SY818J22", "MX2VSWX", "9Z1N65", "8G377PG",
    "VOLXJIFB", "3ZMCE8", "8RVUYQ", "MIBD5GQ", "QTVZL2", "A0QY7JQ", "J2R1FN", "0HVNGL", "I4BZES4", "Y22VG0",
   
    "3VMPTHM", "XXPXAZ", "V22KDR", "37X8E0D", "7W2R8J", "OIQCKVQ", "1K3FEJ", "7G5BMA8", "CZY41J0", "2Y49IVQ",
    "0WBIVH", "MJU40L", "SZJD7OL", "VCP3WO", "KQF92I", "X3A0KUL", "S7JQTV", "L89JGOT", "H7K2U5", "8T0AKW",
    "D7Z6P2", "UM05H1", "4VYOCF", "6I92G5", "LPOB7I", "YN6Z0U",
    "EVENT2025" // Th√™m m√£ n√†y ƒë·ªÉ kh·ªõp v·ªõi logic check code trong renderDeposit
  ];
  const sec = document.createElement('div');
  sec.className = 'section';
  sec.innerHTML = `<div class="title">üîë Nh·∫≠p m√£ nh·∫≠n th∆∞·ªüng</div>
    <div class="card mt8 muted" style="color: var(--red); font-weight: bold;">M√£ th∆∞·ªüng s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t h√†ng ng√†y tr√™n nh√≥m Code Telegram !</div>`;
  const input = document.createElement('input');
  input.placeholder = "Nh·∫≠p m√£ b·∫•t k·ª≥ ƒë·ªÉ nh·∫≠n th∆∞·ªüng";
  input.style.cssText = "width:100%;padding:10px";
  const btn = document.createElement('button');
  btn.className = 'main-btn mt8 redeem-btn-red'; // S·ª¨A: Th√™m class m√†u ƒë·ªè
  btn.style.width = '100%';
  btn.textContent = 'Nh·∫≠n';
  btn.onclick = () => {
    const code = input.value.trim().toUpperCase();
// Check if the code has already been used
    if (codes[code]) {
      return showToast('M√£ ƒë√£ d√πng r·ªìi', '', 'error');
    }

    // Check if the code is in the list of valid codes
    if (!validCodes.includes(code)) {
      return showToast('M√£ kh√¥ng h·ª£p l·ªá', 'Vui l√≤ng ki·ªÉm tra l·∫°i m√£', 'error');
    }

    // If the code is valid and not used, proceed with the reward
    codes[code] = true;
  save(LS.codes, codes);
    const randomReward = Math.floor(Math.random() * (50000 - 10000 + 1)) + 10000;
    // S·ª¨A: Ti·ªÅn nh·∫≠p m√£ l√† ti·ªÅn ƒê√ìNG BƒÇNG (m·∫∑c ƒë·ªãnh)
    updateBalance(randomReward, 'Nh·∫≠p m√£ ' + code);
  addExp(50);
    renderContent();
  };

  sec.appendChild(input);
  sec.appendChild(btn);
  c.appendChild(sec);
}
function renderLeaderboard(c){
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML=`<div class="title">üèÜ B·∫£ng x·∫øp h·∫°ng</div>`;
  const me = { name: user.name, score: (user.exp || 0) + balance / 1000 };
  const bots = [
    { name: 'Aqua', avatar: 'üíô', exp: 12000, balance: 2500000 },
    { name: 'Nova', avatar: '‚ú®', exp: 9800, balance: 1900000 },
    { name: 'Milo', avatar: 'üê±', exp: 6200, balance: 1300000 },
    { name: 'Luna', avatar: 'üåï', exp: 4500, balance: 1050000 },
    { name: 'Leo', avatar: 'ü¶Å', exp: 3800, balance: 800000 },
    { name: 'Ivy', avatar: 'üåø', exp: 2900, balance: 650000 },
  ];
  const list = [...bots, me];
  list.forEach(p => p.score = (p.exp || 0) + (p.balance / 1000));
  list.sort((a, b) => b.score - a.score);

  const tbl = document.createElement('table');
  tbl.className = 'table';
  tbl.innerHTML = '<thead><tr><th>H·∫°ng</th><th>T√™n</th><th>ƒêi·ªÉm</th></tr></thead><tbody></tbody>';
  const tb = tbl.querySelector('tbody');
  list.forEach((p, i) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${i + 1}</td><td>${p.avatar ? p.avatar + ' ' : ''}${p.name}</td><td>${fmt(Math.round(p.score))}</td>`;
    tb.appendChild(tr);
  });
  sec.appendChild(tbl);
  c.appendChild(sec);
}

function weeklyProgress(){
  let vid=0; Object.values(quests).forEach(q=> vid += (q.video||0));
  ensureCheckinWeek();
  const chk = (checkin.days? checkin.days.length : 0);
  return {
    videos: Math.min(vid, 10),
    checkins: Math.min(chk, 7),
    vPct: Math.min(Math.round((vid/10)*100),100),
    cPct: Math.min(Math.round((chk/7)*100),100),
  };
}

// ƒê√É S·ª¨A: Danh s√°ch ng√¢n h√†ng ƒë·∫ßy ƒë·ªß h∆°n
const BANKS = [
  {id:'vcb', name:'Vietcombank', logo:'üü¢', accountNumber:''},
  {id:'tcb', name:'Techcombank', logo:'üü¢', accountNumber:''},
  {id:'bidv', name:'BIDV', logo:'üü¢', accountNumber:''},
  {id:'vtb', name:'VietinBank', logo:'üü¢', accountNumber:''},
  {id:'mb', name:'MB Bank', logo:'üü¢', accountNumber:''},
  {id:'vp', name:'VPBank', logo:'üü¢', accountNumber:''},
  {id:'tp', name:'TPBank', logo:'üü¢', accountNumber:''},
  {id:'vib', name:'VIB', logo:'üü¢', accountNumber:''},
  {id:'hd', name:'HDBank', logo:'üü¢', accountNumber:''},
  {id:'lp', name:'LPBank', logo:'üü¢', accountNumber:''},
  {id:'agr', name:'Agribank', logo:'üü¢', accountNumber:''},
  {id:'acb', name:'ACB', logo:'üü¢', accountNumber:''},
  {id:'scb', name:'Sacombank', logo:'üü¢', accountNumber:''},
  {id:'ocb', name:'OCB', logo:'üü¢', accountNumber:''}
];

function showBankLink(){
  const overlay=document.createElement('div'); overlay.className='overlay';
  const box=document.createElement('div'); box.className='modal';
  
  const form = document.createElement('form');
  form.innerHTML = `
    <div class="row">
      <b>üè¶ Li√™n k·∫øt ng√¢n h√†ng</b>
      <button type="button" class="btn secondary" id="closeB">ƒê√≥ng</button>
    </div>
    <div class="bank-list mt10" style="max-height: 200px; overflow-y: auto; padding: 4px;">
      ${BANKS.map(b => `
        <div class="bank-item" data-bank-id="${b.id}" style="
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(255,255,255,.1);
            border-radius: 999px;
            padding: 6px 10px;
            font-weight: 700;
            box-shadow: 0 3px 8px rgba(0,0,0,.2);
            margin: 4px;
            cursor: pointer;
            transition: border-color 0.2s;
        ">
          <div>${b.logo}</div>
          <div>${b.name}</div>
        </div>`).join('')}
    </div>
    <input type="text" id="accountNumberInput" placeholder="Nh·∫≠p s·ªë t√†i kho·∫£n" style="width:100%;padding:10px;margin-top:10px;font-size:16px;">
 
  
    <button type="submit" class="btn mt10" style="width:100%">L∆∞u</button>
  `;
  
  let selectedBank = null;
  const bankItems = form.querySelectorAll('.bank-item');
  const accountNumberInput = form.querySelector('#accountNumberInput');
  
  // Logic hi·ªÉn th·ªã ng√¢n h√†ng ƒë√£ li√™n k·∫øt (n·∫øu c√≥)
  if(linkedBank){
      const currentBankItem = form.querySelector(`[data-bank-id="${linkedBank.id}"]`);
      if(currentBankItem){
          currentBankItem.style.border = '2px solid var(--brand)';
          selectedBank = BANKS.find(b => b.id === linkedBank.id);
          accountNumberInput.value = linkedBank.accountNumber;
      }
  }
  
  // G√°n s·ª± ki·ªán cho c√°c item ng√¢n h√†ng
  bankItems.forEach(item => {
    item.onclick = () => {
      bankItems.forEach(el => el.style.border = 'none');
      item.style.border = '2px solid var(--brand)';
      selectedBank = BANKS.find(b => b.id === item.dataset.bankId);
    };
  });
  
  form.onsubmit = (e) => {
    e.preventDefault();
    if (!selectedBank) {
      return showToast('L·ªói', 'Vui l√≤ng ch·ªçn m·ªôt ng√¢n h√†ng.', 'error');
    }
    const accountNumber = accountNumberInput.value.trim();
    if (!accountNumber) {
      return showToast('L·ªói', 'Vui l√≤ng nh·∫≠p s·ªë t√†i kho·∫£n.', 'error');
    }

    linkedBank = {
      id: selectedBank.id,
      name: selectedBank.name,
      logo: selectedBank.logo,
      accountNumber: accountNumber
    };
  save(LS.bank, linkedBank);
    overlay.remove();
    showToast("Li√™n k·∫øt th√†nh c√¥ng", "ƒê√£ li√™n k·∫øt "+linkedBank.name, "success");
    renderContent();
  };

  box.appendChild(form);
  overlay.appendChild(box);
  document.body.appendChild(overlay);
  box.querySelector('#closeB').onclick=()=>overlay.remove();
}

function renderFriends(c){
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML = `<div class="title">üë• B·∫°n b√®</div>`;
  const friends = [
    {name:'Aqua', avatar:'üíô', exp:1500, balance:220000},
    {name:'Nova', avatar:'‚ú®', exp: 980, balance:150000},
    {name:'Milo', avatar:'üê±', exp: 620, balance: 90000},
  ];
  friends.forEach(f=>{
    const row=document.createElement('div'); row.className='friend mt8';
    row.innerHTML = `
      <div class="avatar">${f.avatar}</div>
      <div style="flex:1">
        <div class="row"><b>${f.name}</b><span class="muted">EXP ${fmt(f.exp)}</span></div>
        <div class="progress mt8"><div style="width:${Math.min((f.exp%1000)/10,100)}%"></div></div>
        <div class="muted mt8">S·ªë d∆∞: ${fmt(f.balance)} VNƒê</div>
      </div>
      <button class="btn secondary sendTip">T·∫∑ng 5k</button>`;
    row.querySelector('.sendTip').onclick=()=>{
      // S·ª¨A: Ti·ªÅn t·∫∑ng b·∫°n b√® l√† ti·ªÅn tr·ª´ chung (m·∫∑c ƒë·ªãnh)
      if(updateBalance(-5000, `T·∫∑ng ${f.name}`)) showToast('ƒê√£ t·∫∑ng', `B·∫°n t·∫∑ng ${f.name} 5,000 VNƒê`, 'success');
  
    };
    sec.appendChild(row);
  });
  c.appendChild(sec);
}

// ƒê√É S·ª¨A: C·∫≠p nh·∫≠t gi√° Coupon +30k
const SHOP_ITEMS = [
  {id:'exp50', name:'EXP +50', price:20000, type:'EXP', desc:'TƒÉng ngay 50 EXP.'},
  {id:'exp200', name:'EXP +200', price:70000, type:'EXP', desc:'TƒÉng 200 EXP ƒë·ªÉ l√™n c·∫•p nhanh.'},
  {id:'c10', name:'Coupon +10k', price:10000, type:'Coupon', desc:'Th·∫ª c·ªông 10,000 VNƒê v√†o v√≠.'},
  {id:'c30', name:'Coupon +30k', price:30000, type:'Coupon', desc:'Th·∫ª c·ªông 30,000 VNƒê v√†o v√≠.'}, // ƒê√É S·ª¨A GI√Å
  {id:'boost', name:'EXP Boost x2 (24h)', price:120000, type:'Boost', desc:'Nh√¢n ƒë√¥i EXP trong 24 gi·ªù (demo).'},
];
let shopFilter = 'all';

function showItemDetail(it){
  const overlay=document.createElement('div'); overlay.className='overlay';
  const box=document.createElement('div'); box.className='modal';
  box.innerHTML = `
    <div class="row"><b>${it.name}</b><button class="btn secondary" id="cls">ƒê√≥ng</button></div>
    <div class="muted mt8">${it.desc}</div>
    <div class="row mt10"><div><b>Gi√°:</b> ${fmt(it.price)} VNƒê</div><button class="btn" id="buy">Mua ngay</button></div>`;
  overlay.appendChild(box); document.body.appendChild(overlay);
  box.querySelector('#cls').onclick=()=>overlay.remove();
  box.querySelector('#buy').onclick=()=>{
    // S·ª¨A: Tr·ª´ ti·ªÅn mua (m·∫∑c ƒë·ªãnh: ∆∞u ti√™n Kh·∫£ d·ª•ng tr∆∞·ªõc)
    if(updateBalance(-it.price, 'Mua '+it.name)){
      inventory.push(it); save(LS.inventory, inventory); addExp(20);
      overlay.remove();
  showToast('ƒê√£ mua', it.name, 'success'); renderContent();
    }else{
      showToast('Kh√¥ng ƒë·ªß s·ªë d∆∞','N·∫°p th√™m ƒë·ªÉ mua','error');
    }
  };
}

const _oldShop = renderShop;
renderShop = function(c){
  const sec=document.createElement('div'); sec.className='section';
  sec.innerHTML = `<div class="title">üõçÔ∏è C·ª≠a h√†ng</div>`;
  const filter=document.createElement('div'); filter.className='row';
  filter.innerHTML = `
    <div class="chip">L·ªçc:</div>
    <button class="btn secondary" data-ft="all">T·∫•t c·∫£</button>
    <button class="btn secondary" data-ft="EXP">EXP</button>
    <button class="btn secondary" data-ft="Coupon">Coupon</button>
    <button class="btn secondary" data-ft="Boost">Boost</button>
  `;
  filter.querySelectorAll('button[data-ft]').forEach(b=>{
    b.onclick=()=>{ shopFilter=b.getAttribute('data-ft'); renderContent(); };
  });
  sec.appendChild(filter);
  const grid=document.createElement('div'); grid.className='shop-grid mt10';
  SHOP_ITEMS.filter(it=> shopFilter==='all' || it.type===shopFilter).forEach(it=>{
    const el=document.createElement('div'); el.className='item';
    el.innerHTML = `
      <h4>${it.name}</h4>
      <div class="muted">${it.type}</div>
      <div class="row mt8">
        <div class="price">${fmt(it.price)} VNƒê</div>
        <button class="btn secondary">Chi ti·∫øt</button>
      </div>`;
    el.querySelector('button').onclick=()=>showItemDetail(it);
    grid.appendChild(el);
  });
  if(!grid.children.length){
    const none=document.createElement('div'); none.textContent='Kh√¥ng c√≥ s·∫£n ph·∫©m.';
    sec.appendChild(none);
  }else{
    sec.appendChild(grid);
  }
  c.appendChild(sec);
};

let notifications = [
  {title:"üéÅ M√£ Gi·ªõi Thi·ªáu Tik Tok Lite  ", msg:"Nh·∫≠p m√£ EVENT2025 nh·∫≠n ngay 25,000 VNƒê"},
  {title:"üî• Nhi·ªám v·ª• tu·∫ßn", msg:"Xem ƒë·ªß 10 video & ƒëi·ªÉm danh 7 ng√†y ƒë·ªÉ nh·∫≠n +300k"},
  {title:"üõçÔ∏è Shop", msg:"M·ªü b√°n g√≥i EXP Boost m·ªõi"}
];
function showNotifications(){
  const overlay=document.createElement('div'); overlay.className='overlay';
  const box=document.createElement('div'); box.className='modal';
  box.innerHTML = `<div class="row"><b>üîî Th√¥ng b√°o</b><button class="btn secondary" id="closeN">ƒê√≥ng</button></div>`;
  notifications.forEach(n=>{
    const card=document.createElement('div'); card.className='card';
    card.innerHTML = `<div><b>${n.title}</b></div><div class="muted">${n.msg}</div>`;
    box.appendChild(card);
  });
  overlay.appendChild(box); document.body.appendChild(overlay);
  box.querySelector('#closeN').onclick=()=>overlay.remove();
}

const _oldHeader = renderHeader;
let _bellMounted = false;
renderHeader = function(){
  _oldHeader();
  if(!_bellMounted){
    const bell = document.createElement('button');
    bell.className='btn secondary';
    bell.style.marginLeft='8px';
    bell.innerHTML='üîî';
    bell.onclick=showNotifications;
    document.querySelector('.brand').appendChild(bell);
    _bellMounted = true;
  }
};
/* ===== NEW CHATBOT JAVASCRIPT & CONTACT BUTTON LOGIC (ƒê√É S·ª¨A) ===== */
document.addEventListener('DOMContentLoaded', () => {
    const chatButton = $('#chatButton');
    const chatWindow = $('#chatWindow');
    const closeChat = $('#closeChat');
    const chatMessages = $('#chatMessages');
    const chatInput = $('#chatInput');
    const sendChat = $('#sendChat');
    const contactButton = $('#contactButton'); // N√∫t li√™n h·ªá m·ªõi
    const TELEGRAM_LINK = 'https://t.me/nhatpham27';

    // --- H√ÄM M·ªöI: HI·ªÇN TH·ªä MODAL H·ªñ TR·ª¢ ---
    function showContactModal() {
        const overlay = document.createElement('div');
        overlay.className = 'overlay';
        const box = document.createElement('div');
        box.className = 'modal';
        box.style.maxWidth = '300px'; 
        
        box.innerHTML = `
            <div class="center" style="font-size: 30px; margin-bottom: 10px; font-weight: 900; color: var(--support-green);">
                <i class="fa-brands fa-telegram"></i> H·ªó tr·ª£
            </div>
            <p style="text-align: center; margin-bottom: 20px; font-weight: 600;">
                B·∫°n c√≥ v·∫•n ƒë·ªÅ c·∫ßn h·ªó tr·ª£? Vui l√≤ng chuy·ªÉn ƒë·∫øn k√™nh Telegram c·ªßa Admin ƒë·ªÉ gi·∫£i quy·∫øt nhanh nh·∫•t.
            </p>
            <a id="goToTelegramBtn" href="${TELEGRAM_LINK}" target="_blank" class="btn" style="width:100%; padding: 12px; background: var(--blue); color: white; display: block; text-decoration: none; font-weight: 800;">
                 Chuy·ªÉn ƒë·∫øn Telegram
            </a>
            <button id="closeModalBtn" class="btn secondary mt8" style="width:100%; background: #495057; color: white;">
                ƒê√≥ng
            </button>
        `;
        
        // C·∫ßn g√°n l·∫°i s·ª± ki·ªán cho c√°c n√∫t trong modal m·ªõi t·∫°o
        box.querySelector('#closeModalBtn').onclick = () => {
            overlay.remove();
        };
        // N√∫t Telegram t·ª± ƒë·ªông m·ªü link do l√† th·∫ª <a> v·ªõi target="_blank"

        overlay.appendChild(box);
        document.body.appendChild(overlay);
    }
    // -------------------------------------

    chatButton.addEventListener('click', () => {
        chatWindow.classList.toggle('open');
        chatMessages.scrollTop = chatMessages.scrollHeight;
    });

    closeChat.addEventListener('click', () => {
        chatWindow.classList.remove('open');
    });
    
    // Logic m·ªõi cho n√∫t Li√™n h·ªá: M·ªü Modal
    contactButton.addEventListener('click', showContactModal);

 
  
    function addMessage(text, isUser = false) {
        const msgDiv = document.createElement('div');
        msgDiv.className = `message ${isUser ? 'user' : 'bot'}`;
        msgDiv.textContent = text;
        chatMessages.appendChild(msgDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function getBotResponse(message) {
        const msg = message.toLowerCase().trim();
  if (msg.includes('ch√†o') || msg.includes('hello')) {
            return "Xin ch√†o! T√¥i l√† GGL Chatbot. T√¥i c√≥ th·ªÉ h·ªó tr·ª£ g√¨ cho b·∫°n?";
  }
        if (msg.includes('r√∫t ti·ªÅn') || msg.includes('r√∫t')) {
            return "ƒê·ªÉ r√∫t ti·ªÅn, b·∫°n h√£y v√†o m·ª•c **V√≠ & L·ªãch s·ª≠ > L·ªãch s·ª≠ r√∫t**. L∆∞u √Ω: Ch·ªâ c√≥ th·ªÉ r√∫t ti·ªÅn Kh·∫£ d·ª•ng.";
  }
        if (msg.includes('n·∫°p ti·ªÅn') || msg.includes('n·∫°p')) {
            return "B·∫°n c√≥ th·ªÉ n·∫°p ti·ªÅn t·∫°i m·ª•c **V√≠ & L·ªãch s·ª≠ > N·∫°p ti·ªÅn**. Ti·ªÅn n·∫°p s·∫Ω ƒë∆∞·ª£c c·ªông v√†o S·ªë d∆∞ **ƒê√≥ng bƒÉng**.";
  }
        if (msg.includes('nhi·ªám v·ª•') || msg.includes('daily')) {
            return "Nhi·ªám v·ª• h√†ng ng√†y gi√∫p b·∫°n ki·∫øm ti·ªÅn v√† EXP. Ti·ªÅn th∆∞·ªüng nhi·ªám v·ª• s·∫Ω l√† ti·ªÅn **ƒê√≥ng bƒÉng**.";
  }
        if (msg.includes('ƒëi·ªÉm danh') || msg.includes('diem danh')) {
            return "B·∫°n c√≥ th·ªÉ ƒëi·ªÉm danh m·ªói ng√†y ƒë·ªÉ nh·∫≠n ti·ªÅn th∆∞·ªüng **ƒê√≥ng bƒÉng**. V√†o m·ª•c **ƒêi·ªÉm danh** ƒë·ªÉ th·ª±c hi·ªán.";
  }
        if (msg.includes('li√™n h·ªá')) {
            return "N·∫øu b·∫°n c·∫ßn h·ªó tr·ª£ th√™m, vui l√≤ng li√™n h·ªá Zalo: ********** ho·∫∑c Email: **gogo@support.com**.";
  }
        
        return "T√¥i ch∆∞a hi·ªÉu √Ω b·∫°n. B·∫°n c√≥ th·ªÉ h·ªèi v·ªÅ r√∫t/n·∫°p ti·ªÅn, nhi·ªám v·ª• ho·∫∑c ƒëi·ªÉm danh.";
  }

    function sendMessage() {
        const text = chatInput.value.trim();
  if (text === '') return;
        
        addMessage(text, true);
        chatInput.value = '';
  setTimeout(() => {
            const botResponse = getBotResponse(text);
            addMessage(botResponse, false);
        }, 500);
  }

    sendChat.addEventListener('click', sendMessage);
    chatInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });
// Initial bot message
    setTimeout(() => {
        addMessage("Xin ch√†o! T√¥i l√† GGL Chatbot. T√¥i c√≥ th·ªÉ h·ªó tr·ª£ g√¨ cho b·∫°n?");
    }, 1000);
/* ===== DRAGGABLE CHAT BUBBLE (Logic gi·ªØ nguy√™n) ===== */
    const chatBubble = $('.chat-bubble');
    let isDragging = false;
  let offsetX, offsetY;

    chatBubble.addEventListener('mousedown', (e) => {
        isDragging = true;
        chatBubble.classList.add('dragging');
        offsetX = e.clientX - chatBubble.getBoundingClientRect().left;
        offsetY = e.clientY - chatBubble.getBoundingClientRect().top;
    });
  document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        // Logic di chuy·ªÉn b·ªã b·ªè qua do d√πng position: fixed/left
    });
  document.addEventListener('mouseup', () => {
        if (!isDragging) return;
        isDragging = false;
        chatBubble.classList.remove('dragging');
    });
// Prevent text selection while dragging
    chatBubble.addEventListener('selectstart', (e) => {
        e.preventDefault();
    });
  });

/* ====== Login Logic (ƒê√É S·ª¨A M√É GI·ªöI THI·ªÜU V√Ä ID TIKTOK) ====== */
document.addEventListener('DOMContentLoaded', () => {
    const loginContainer = $('#loginContainer');
    const appContainer = $('#app');
    const loginBtn = $('#loginBtn');
    
    // Th√™m c√°c input m·ªõi
    const referralCodeInput = $('#referralCodeInput');
    const tiktokIdInput = $('#tiktokIdInput');

    // C·∫≠p nh·∫≠t danh s√°ch M√£ Gi·ªõi thi·ªáu v√† ID TikTok H·ª£p l·ªá
    const VALID_REFERRAL_CODES = [
        'DACDTTH07', 'FGYB65RT', 'NHBVCX43', 'TGY67HNM', 'MNJKL89P', 
        'GFD56SAD', 'TYUI345G', 'HJKL90NM', 'BVCX78FG', 'RTYU65GH', 
        'CVBN90LK', 'USERCHUNH'
    ];
    const VALID_TIKTOK_IDS = [
        'caddtth2102', 'fghjkkmn345', 'cvbnmqw3456', 'xzaqscv2109', 
        'mnbvccx8901', 'poiuytrewq2', 'lkjhgfd4567', 'zxcvbnnb654', 
        'dfgyuikm321', 'hjklopcba987', 'nbvcxzasdf1'
    ];
    
    function checkLoginStatus() {
        if (localStorage.getItem(LS.isLoggedIn) === 'true') {
            loginContainer.style.display = 'none';
        
            appContainer.style.display = 'flex';
            initApp();
        } else {
            loginContainer.style.display = 'flex';
            appContainer.style.display = 'none';
        }
    }
    
    function handleLogin() {
        const username = $('#usernameInput').value;
        const password = $('#passwordInput').value;
        const referralCode = referralCodeInput.value.trim().toUpperCase(); // Chuy·ªÉn sang HOA ƒë·ªÉ so s√°nh
        const tiktokId = tiktokIdInput.value.trim().toLowerCase(); // Chuy·ªÉn sang th∆∞·ªùng ƒë·ªÉ so s√°nh

        
        // Ki·ªÉm tra t·∫•t c·∫£ c√°c tr∆∞·ªùng
        if (username.length === 0 || password.length === 0 || referralCode.length === 0 || tiktokId.length === 0) {
            showToast('L·ªói', 'Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin.', 'error');
            return;
        }

        if (!VALID_REFERRAL_CODES.includes(referralCode)) {
            showToast('L·ªói', 'M√£ gi·ªõi thi·ªáu kh√¥ng h·ª£p l·ªá.', 'error');
            return;
        }

        if (!VALID_TIKTOK_IDS.includes(tiktokId)) {
            showToast('L·ªói', 'ID TikTok kh√¥ng h·ª£p l·ªá.', 'error');
            return;
        }

        // N·∫øu t·∫•t c·∫£ ƒë·ªÅu ƒë√∫ng, cho ph√©p ƒëƒÉng nh·∫≠p
        localStorage.setItem(LS.isLoggedIn, 'true');
        checkLoginStatus();
    }
    
    loginBtn.addEventListener('click', handleLogin);
// Check login status on page load
    checkLoginStatus();
});

function initApp() {
/* ====== Init load ====== */
renderHeader();
renderMainMenu();
renderSubTabs();
renderContent();
}
</script>
</body>
</html>
